<html>
<head>
<title>mongo_client.ts</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #67a37c; font-style: italic;}
.s6 { color: #7a7e85;}
.s7 { color: #2aacb8;}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
mongo_client.ts</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">promises </span><span class="s2">as </span><span class="s1">fs </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'fs'</span><span class="s2">;</span>
<a name="l2"><span class="ln">2    </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">TcpNetConnectOpts </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'net'</span><span class="s2">;</span>
<a name="l3"><span class="ln">3    </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">ConnectionOptions </span><span class="s2">as </span><span class="s1">TLSConnectionOptions</span><span class="s2">, </span><span class="s1">TLSSocketOptions </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'tls'</span><span class="s2">;</span>
<a name="l4"><span class="ln">4    </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">promisify </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'util'</span><span class="s2">;</span>
<a name="l5"><span class="ln">5    </span></a>
<a name="l6"><span class="ln">6    </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">type BSONSerializeOptions</span><span class="s2">, </span><span class="s1">type Document</span><span class="s2">, </span><span class="s1">resolveBSONOptions </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./bson'</span><span class="s2">;</span>
<a name="l7"><span class="ln">7    </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">ChangeStream</span><span class="s2">, </span><span class="s1">type ChangeStreamDocument</span><span class="s2">, </span><span class="s1">type ChangeStreamOptions </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./change_stream'</span><span class="s2">;</span>
<a name="l8"><span class="ln">8    </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">AutoEncrypter</span><span class="s2">, </span><span class="s1">AutoEncryptionOptions </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./client-side-encryption/auto_encrypter'</span><span class="s2">;</span>
<a name="l9"><span class="ln">9    </span></a><span class="s0">import </span><span class="s2">{</span>
<a name="l10"><span class="ln">10   </span></a>  <span class="s1">type AuthMechanismProperties</span><span class="s2">,</span>
<a name="l11"><span class="ln">11   </span></a>  <span class="s1">DEFAULT_ALLOWED_HOSTS</span><span class="s2">,</span>
<a name="l12"><span class="ln">12   </span></a>  <span class="s1">type MongoCredentials</span>
<a name="l13"><span class="ln">13   </span></a><span class="s2">} </span><span class="s1">from </span><span class="s3">'./cmap/auth/mongo_credentials'</span><span class="s2">;</span>
<a name="l14"><span class="ln">14   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">AuthMechanism </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./cmap/auth/providers'</span><span class="s2">;</span>
<a name="l15"><span class="ln">15   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">LEGAL_TCP_SOCKET_OPTIONS</span><span class="s2">, </span><span class="s1">LEGAL_TLS_SOCKET_OPTIONS </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./cmap/connect'</span><span class="s2">;</span>
<a name="l16"><span class="ln">16   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">Connection </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./cmap/connection'</span><span class="s2">;</span>
<a name="l17"><span class="ln">17   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">ClientMetadata </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./cmap/handshake/client_metadata'</span><span class="s2">;</span>
<a name="l18"><span class="ln">18   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">CompressorName </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./cmap/wire_protocol/compression'</span><span class="s2">;</span>
<a name="l19"><span class="ln">19   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">parseOptions</span><span class="s2">, </span><span class="s1">resolveSRVRecord </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./connection_string'</span><span class="s2">;</span>
<a name="l20"><span class="ln">20   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">MONGO_CLIENT_EVENTS </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./constants'</span><span class="s2">;</span>
<a name="l21"><span class="ln">21   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">Db</span><span class="s2">, </span><span class="s1">type DbOptions </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./db'</span><span class="s2">;</span>
<a name="l22"><span class="ln">22   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">Encrypter </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./encrypter'</span><span class="s2">;</span>
<a name="l23"><span class="ln">23   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">MongoInvalidArgumentError </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./error'</span><span class="s2">;</span>
<a name="l24"><span class="ln">24   </span></a><span class="s0">import </span><span class="s2">{</span>
<a name="l25"><span class="ln">25   </span></a>  <span class="s1">type LogComponentSeveritiesClientOptions</span><span class="s2">,</span>
<a name="l26"><span class="ln">26   </span></a>  <span class="s1">type MongoDBLogWritable</span><span class="s2">,</span>
<a name="l27"><span class="ln">27   </span></a>  <span class="s1">MongoLogger</span><span class="s2">,</span>
<a name="l28"><span class="ln">28   </span></a>  <span class="s1">type MongoLoggerOptions</span>
<a name="l29"><span class="ln">29   </span></a><span class="s2">} </span><span class="s1">from </span><span class="s3">'./mongo_logger'</span><span class="s2">;</span>
<a name="l30"><span class="ln">30   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">TypedEventEmitter </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./mongo_types'</span><span class="s2">;</span>
<a name="l31"><span class="ln">31   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">executeOperation </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./operations/execute_operation'</span><span class="s2">;</span>
<a name="l32"><span class="ln">32   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">RunAdminCommandOperation </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./operations/run_command'</span><span class="s2">;</span>
<a name="l33"><span class="ln">33   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">ReadConcern</span><span class="s2">, </span><span class="s1">ReadConcernLevel</span><span class="s2">, </span><span class="s1">ReadConcernLike </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./read_concern'</span><span class="s2">;</span>
<a name="l34"><span class="ln">34   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">ReadPreference</span><span class="s2">, </span><span class="s1">type ReadPreferenceMode </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./read_preference'</span><span class="s2">;</span>
<a name="l35"><span class="ln">35   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">ServerMonitoringMode </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./sdam/monitor'</span><span class="s2">;</span>
<a name="l36"><span class="ln">36   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">TagSet </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./sdam/server_description'</span><span class="s2">;</span>
<a name="l37"><span class="ln">37   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">readPreferenceServerSelector </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./sdam/server_selection'</span><span class="s2">;</span>
<a name="l38"><span class="ln">38   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">SrvPoller </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./sdam/srv_polling'</span><span class="s2">;</span>
<a name="l39"><span class="ln">39   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">Topology</span><span class="s2">, </span><span class="s1">type TopologyEvents </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./sdam/topology'</span><span class="s2">;</span>
<a name="l40"><span class="ln">40   </span></a><span class="s0">import </span><span class="s2">{ </span><span class="s1">ClientSession</span><span class="s2">, </span><span class="s1">type ClientSessionOptions</span><span class="s2">, </span><span class="s1">ServerSessionPool </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./sessions'</span><span class="s2">;</span>
<a name="l41"><span class="ln">41   </span></a><span class="s0">import </span><span class="s2">{</span>
<a name="l42"><span class="ln">42   </span></a>  <span class="s1">COSMOS_DB_CHECK</span><span class="s2">,</span>
<a name="l43"><span class="ln">43   </span></a>  <span class="s1">COSMOS_DB_MSG</span><span class="s2">,</span>
<a name="l44"><span class="ln">44   </span></a>  <span class="s1">DOCUMENT_DB_CHECK</span><span class="s2">,</span>
<a name="l45"><span class="ln">45   </span></a>  <span class="s1">DOCUMENT_DB_MSG</span><span class="s2">,</span>
<a name="l46"><span class="ln">46   </span></a>  <span class="s1">type HostAddress</span><span class="s2">,</span>
<a name="l47"><span class="ln">47   </span></a>  <span class="s1">hostMatchesWildcards</span><span class="s2">,</span>
<a name="l48"><span class="ln">48   </span></a>  <span class="s1">isHostMatch</span><span class="s2">,</span>
<a name="l49"><span class="ln">49   </span></a>  <span class="s1">type MongoDBNamespace</span><span class="s2">,</span>
<a name="l50"><span class="ln">50   </span></a>  <span class="s1">ns</span><span class="s2">,</span>
<a name="l51"><span class="ln">51   </span></a>  <span class="s1">resolveOptions</span>
<a name="l52"><span class="ln">52   </span></a><span class="s2">} </span><span class="s1">from </span><span class="s3">'./utils'</span><span class="s2">;</span>
<a name="l53"><span class="ln">53   </span></a><span class="s0">import </span><span class="s1">type </span><span class="s2">{ </span><span class="s1">W</span><span class="s2">, </span><span class="s1">WriteConcern</span><span class="s2">, </span><span class="s1">WriteConcernSettings </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./write_concern'</span><span class="s2">;</span>
<a name="l54"><span class="ln">54   </span></a>
<a name="l55"><span class="ln">55   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l56"><span class="ln">56   </span></a><span class="s0">export const </span><span class="s1">ServerApiVersion </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze</span><span class="s2">({</span>
<a name="l57"><span class="ln">57   </span></a>  <span class="s1">v1</span><span class="s2">: </span><span class="s3">'1'</span>
<a name="l58"><span class="ln">58   </span></a><span class="s2">} as </span><span class="s0">const</span><span class="s2">);</span>
<a name="l59"><span class="ln">59   </span></a>
<a name="l60"><span class="ln">60   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l61"><span class="ln">61   </span></a><span class="s0">export </span><span class="s1">type ServerApiVersion </span><span class="s2">= (</span><span class="s0">typeof </span><span class="s1">ServerApiVersion</span><span class="s2">)[</span><span class="s1">keyof </span><span class="s0">typeof </span><span class="s1">ServerApiVersion</span><span class="s2">];</span>
<a name="l62"><span class="ln">62   </span></a>
<a name="l63"><span class="ln">63   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l64"><span class="ln">64   </span></a><span class="s0">export interface </span><span class="s1">ServerApi </span><span class="s2">{</span>
<a name="l65"><span class="ln">65   </span></a>  <span class="s1">version</span><span class="s2">: </span><span class="s1">ServerApiVersion</span><span class="s2">;</span>
<a name="l66"><span class="ln">66   </span></a>  <span class="s1">strict</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l67"><span class="ln">67   </span></a>  <span class="s1">deprecationErrors</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l68"><span class="ln">68   </span></a><span class="s2">}</span>
<a name="l69"><span class="ln">69   </span></a>
<a name="l70"><span class="ln">70   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l71"><span class="ln">71   </span></a><span class="s0">export interface </span><span class="s1">DriverInfo </span><span class="s2">{</span>
<a name="l72"><span class="ln">72   </span></a>  <span class="s1">name</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l73"><span class="ln">73   </span></a>  <span class="s1">version</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l74"><span class="ln">74   </span></a>  <span class="s1">platform</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l75"><span class="ln">75   </span></a><span class="s2">}</span>
<a name="l76"><span class="ln">76   </span></a>
<a name="l77"><span class="ln">77   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l78"><span class="ln">78   </span></a><span class="s0">export interface </span><span class="s1">Auth </span><span class="s2">{</span>
<a name="l79"><span class="ln">79   </span></a>  <span class="s4">/** The username for auth */</span>
<a name="l80"><span class="ln">80   </span></a>  <span class="s1">username</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l81"><span class="ln">81   </span></a>  <span class="s4">/** The password for auth */</span>
<a name="l82"><span class="ln">82   </span></a>  <span class="s1">password</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l83"><span class="ln">83   </span></a><span class="s2">}</span>
<a name="l84"><span class="ln">84   </span></a>
<a name="l85"><span class="ln">85   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l86"><span class="ln">86   </span></a><span class="s0">export interface </span><span class="s1">PkFactory </span><span class="s2">{</span>
<a name="l87"><span class="ln">87   </span></a>  <span class="s1">createPk</span><span class="s2">(): </span><span class="s1">any</span><span class="s2">; </span><span class="s6">// TODO: when js-bson is typed, function should return some BSON type</span>
<a name="l88"><span class="ln">88   </span></a><span class="s2">}</span>
<a name="l89"><span class="ln">89   </span></a>
<a name="l90"><span class="ln">90   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l91"><span class="ln">91   </span></a><span class="s0">export </span><span class="s1">type SupportedTLSConnectionOptions </span><span class="s2">= </span><span class="s1">Pick</span><span class="s2">&lt;</span>
<a name="l92"><span class="ln">92   </span></a>  <span class="s1">TLSConnectionOptions</span><span class="s2">,</span>
<a name="l93"><span class="ln">93   </span></a>  <span class="s1">Extract</span><span class="s2">&lt;</span><span class="s1">keyof TLSConnectionOptions</span><span class="s2">, (</span><span class="s0">typeof </span><span class="s1">LEGAL_TLS_SOCKET_OPTIONS</span><span class="s2">)[</span><span class="s1">number</span><span class="s2">]&gt;</span>
<a name="l94"><span class="ln">94   </span></a><span class="s2">&gt;;</span>
<a name="l95"><span class="ln">95   </span></a>
<a name="l96"><span class="ln">96   </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l97"><span class="ln">97   </span></a><span class="s0">export </span><span class="s1">type SupportedTLSSocketOptions </span><span class="s2">= </span><span class="s1">Pick</span><span class="s2">&lt;</span>
<a name="l98"><span class="ln">98   </span></a>  <span class="s1">TLSSocketOptions</span><span class="s2">,</span>
<a name="l99"><span class="ln">99   </span></a>  <span class="s1">Extract</span><span class="s2">&lt;</span><span class="s1">keyof TLSSocketOptions</span><span class="s2">, (</span><span class="s0">typeof </span><span class="s1">LEGAL_TLS_SOCKET_OPTIONS</span><span class="s2">)[</span><span class="s1">number</span><span class="s2">]&gt;</span>
<a name="l100"><span class="ln">100  </span></a><span class="s2">&gt;;</span>
<a name="l101"><span class="ln">101  </span></a>
<a name="l102"><span class="ln">102  </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l103"><span class="ln">103  </span></a><span class="s0">export </span><span class="s1">type SupportedSocketOptions </span><span class="s2">= </span><span class="s1">Pick</span><span class="s2">&lt;</span>
<a name="l104"><span class="ln">104  </span></a>  <span class="s1">TcpNetConnectOpts</span><span class="s2">,</span>
<a name="l105"><span class="ln">105  </span></a>  <span class="s2">(</span><span class="s0">typeof </span><span class="s1">LEGAL_TCP_SOCKET_OPTIONS</span><span class="s2">)[</span><span class="s1">number</span><span class="s2">]</span>
<a name="l106"><span class="ln">106  </span></a><span class="s2">&gt;;</span>
<a name="l107"><span class="ln">107  </span></a>
<a name="l108"><span class="ln">108  </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l109"><span class="ln">109  </span></a><span class="s0">export </span><span class="s1">type SupportedNodeConnectionOptions </span><span class="s2">= </span><span class="s1">SupportedTLSConnectionOptions </span><span class="s2">&amp;</span>
<a name="l110"><span class="ln">110  </span></a>  <span class="s1">SupportedTLSSocketOptions </span><span class="s2">&amp;</span>
<a name="l111"><span class="ln">111  </span></a>  <span class="s1">SupportedSocketOptions</span><span class="s2">;</span>
<a name="l112"><span class="ln">112  </span></a>
<a name="l113"><span class="ln">113  </span></a><span class="s4">/**</span>
<a name="l114"><span class="ln">114  </span></a> <span class="s4">* Describes all possible URI query options for the mongo client</span>
<a name="l115"><span class="ln">115  </span></a> <span class="s4">* </span><span class="s5">@public</span>
<a name="l116"><span class="ln">116  </span></a> <span class="s4">* </span><span class="s5">@see </span><span class="s4">https://www.mongodb.com/docs/manual/reference/connection-string</span>
<a name="l117"><span class="ln">117  </span></a> <span class="s4">*/</span>
<a name="l118"><span class="ln">118  </span></a><span class="s0">export interface </span><span class="s1">MongoClientOptions </span><span class="s0">extends </span><span class="s1">BSONSerializeOptions</span><span class="s2">, </span><span class="s1">SupportedNodeConnectionOptions </span><span class="s2">{</span>
<a name="l119"><span class="ln">119  </span></a>  <span class="s4">/** Specifies the name of the replica set, if the mongod is a member of a replica set. */</span>
<a name="l120"><span class="ln">120  </span></a>  <span class="s1">replicaSet</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l121"><span class="ln">121  </span></a>  <span class="s4">/** Enables or disables TLS/SSL for the connection. */</span>
<a name="l122"><span class="ln">122  </span></a>  <span class="s1">tls</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l123"><span class="ln">123  </span></a>  <span class="s4">/** A boolean to enable or disables TLS/SSL for the connection. (The ssl option is equivalent to the tls option.) */</span>
<a name="l124"><span class="ln">124  </span></a>  <span class="s1">ssl</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l125"><span class="ln">125  </span></a>  <span class="s4">/** Specifies the location of a local .pem file that contains either the client's TLS/SSL certificate and key. */</span>
<a name="l126"><span class="ln">126  </span></a>  <span class="s1">tlsCertificateKeyFile</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l127"><span class="ln">127  </span></a>  <span class="s4">/** Specifies the password to de-crypt the tlsCertificateKeyFile. */</span>
<a name="l128"><span class="ln">128  </span></a>  <span class="s1">tlsCertificateKeyFilePassword</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l129"><span class="ln">129  </span></a>  <span class="s4">/** Specifies the location of a local .pem file that contains the root certificate chain from the Certificate Authority. This file is used to validate the certificate presented by the mongod/mongos instance. */</span>
<a name="l130"><span class="ln">130  </span></a>  <span class="s1">tlsCAFile</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l131"><span class="ln">131  </span></a>  <span class="s4">/** Specifies the location of a local CRL .pem file that contains the client revokation list. */</span>
<a name="l132"><span class="ln">132  </span></a>  <span class="s1">tlsCRLFile</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l133"><span class="ln">133  </span></a>  <span class="s4">/** Bypasses validation of the certificates presented by the mongod/mongos instance */</span>
<a name="l134"><span class="ln">134  </span></a>  <span class="s1">tlsAllowInvalidCertificates</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l135"><span class="ln">135  </span></a>  <span class="s4">/** Disables hostname validation of the certificate presented by the mongod/mongos instance. */</span>
<a name="l136"><span class="ln">136  </span></a>  <span class="s1">tlsAllowInvalidHostnames</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l137"><span class="ln">137  </span></a>  <span class="s4">/** Disables various certificate validations. */</span>
<a name="l138"><span class="ln">138  </span></a>  <span class="s1">tlsInsecure</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l139"><span class="ln">139  </span></a>  <span class="s4">/** The time in milliseconds to attempt a connection before timing out. */</span>
<a name="l140"><span class="ln">140  </span></a>  <span class="s1">connectTimeoutMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l141"><span class="ln">141  </span></a>  <span class="s4">/** The time in milliseconds to attempt a send or receive on a socket before the attempt times out. */</span>
<a name="l142"><span class="ln">142  </span></a>  <span class="s1">socketTimeoutMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l143"><span class="ln">143  </span></a>  <span class="s4">/** An array or comma-delimited string of compressors to enable network compression for communication between this client and a mongod/mongos instance. */</span>
<a name="l144"><span class="ln">144  </span></a>  <span class="s1">compressors</span><span class="s2">?: </span><span class="s1">CompressorName</span><span class="s2">[] | </span><span class="s1">string</span><span class="s2">;</span>
<a name="l145"><span class="ln">145  </span></a>  <span class="s4">/** An integer that specifies the compression level if using zlib for network compression. */</span>
<a name="l146"><span class="ln">146  </span></a>  <span class="s1">zlibCompressionLevel</span><span class="s2">?: </span><span class="s7">0 </span><span class="s2">| </span><span class="s7">1 </span><span class="s2">| </span><span class="s7">2 </span><span class="s2">| </span><span class="s7">3 </span><span class="s2">| </span><span class="s7">4 </span><span class="s2">| </span><span class="s7">5 </span><span class="s2">| </span><span class="s7">6 </span><span class="s2">| </span><span class="s7">7 </span><span class="s2">| </span><span class="s7">8 </span><span class="s2">| </span><span class="s7">9 </span><span class="s2">| </span><span class="s1">undefined</span><span class="s2">;</span>
<a name="l147"><span class="ln">147  </span></a>  <span class="s4">/** The maximum number of hosts to connect to when using an srv connection string, a setting of `0` means unlimited hosts */</span>
<a name="l148"><span class="ln">148  </span></a>  <span class="s1">srvMaxHosts</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l149"><span class="ln">149  </span></a>  <span class="s4">/**</span>
<a name="l150"><span class="ln">150  </span></a>   <span class="s4">* Modifies the srv URI to look like:</span>
<a name="l151"><span class="ln">151  </span></a>   <span class="s4">*</span>
<a name="l152"><span class="ln">152  </span></a>   <span class="s4">* `_{srvServiceName}._tcp.{hostname}.{domainname}`</span>
<a name="l153"><span class="ln">153  </span></a>   <span class="s4">*</span>
<a name="l154"><span class="ln">154  </span></a>   <span class="s4">* Querying this DNS URI is expected to respond with SRV records</span>
<a name="l155"><span class="ln">155  </span></a>   <span class="s4">*/</span>
<a name="l156"><span class="ln">156  </span></a>  <span class="s1">srvServiceName</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l157"><span class="ln">157  </span></a>  <span class="s4">/** The maximum number of connections in the connection pool. */</span>
<a name="l158"><span class="ln">158  </span></a>  <span class="s1">maxPoolSize</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l159"><span class="ln">159  </span></a>  <span class="s4">/** The minimum number of connections in the connection pool. */</span>
<a name="l160"><span class="ln">160  </span></a>  <span class="s1">minPoolSize</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l161"><span class="ln">161  </span></a>  <span class="s4">/** The maximum number of connections that may be in the process of being established concurrently by the connection pool. */</span>
<a name="l162"><span class="ln">162  </span></a>  <span class="s1">maxConnecting</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l163"><span class="ln">163  </span></a>  <span class="s4">/** The maximum number of milliseconds that a connection can remain idle in the pool before being removed and closed. */</span>
<a name="l164"><span class="ln">164  </span></a>  <span class="s1">maxIdleTimeMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l165"><span class="ln">165  </span></a>  <span class="s4">/** The maximum time in milliseconds that a thread can wait for a connection to become available. */</span>
<a name="l166"><span class="ln">166  </span></a>  <span class="s1">waitQueueTimeoutMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l167"><span class="ln">167  </span></a>  <span class="s4">/** Specify a read concern for the collection (only MongoDB 3.2 or higher supported) */</span>
<a name="l168"><span class="ln">168  </span></a>  <span class="s1">readConcern</span><span class="s2">?: </span><span class="s1">ReadConcernLike</span><span class="s2">;</span>
<a name="l169"><span class="ln">169  </span></a>  <span class="s4">/** The level of isolation */</span>
<a name="l170"><span class="ln">170  </span></a>  <span class="s1">readConcernLevel</span><span class="s2">?: </span><span class="s1">ReadConcernLevel</span><span class="s2">;</span>
<a name="l171"><span class="ln">171  </span></a>  <span class="s4">/** Specifies the read preferences for this connection */</span>
<a name="l172"><span class="ln">172  </span></a>  <span class="s1">readPreference</span><span class="s2">?: </span><span class="s1">ReadPreferenceMode </span><span class="s2">| </span><span class="s1">ReadPreference</span><span class="s2">;</span>
<a name="l173"><span class="ln">173  </span></a>  <span class="s4">/** Specifies, in seconds, how stale a secondary can be before the client stops using it for read operations. */</span>
<a name="l174"><span class="ln">174  </span></a>  <span class="s1">maxStalenessSeconds</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l175"><span class="ln">175  </span></a>  <span class="s4">/** Specifies the tags document as a comma-separated list of colon-separated key-value pairs.  */</span>
<a name="l176"><span class="ln">176  </span></a>  <span class="s1">readPreferenceTags</span><span class="s2">?: </span><span class="s1">TagSet</span><span class="s2">[];</span>
<a name="l177"><span class="ln">177  </span></a>  <span class="s4">/** The auth settings for when connection to server. */</span>
<a name="l178"><span class="ln">178  </span></a>  <span class="s1">auth</span><span class="s2">?: </span><span class="s1">Auth</span><span class="s2">;</span>
<a name="l179"><span class="ln">179  </span></a>  <span class="s4">/** Specify the database name associated with the userâ€™s credentials. */</span>
<a name="l180"><span class="ln">180  </span></a>  <span class="s1">authSource</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l181"><span class="ln">181  </span></a>  <span class="s4">/** Specify the authentication mechanism that MongoDB will use to authenticate the connection. */</span>
<a name="l182"><span class="ln">182  </span></a>  <span class="s1">authMechanism</span><span class="s2">?: </span><span class="s1">AuthMechanism</span><span class="s2">;</span>
<a name="l183"><span class="ln">183  </span></a>  <span class="s4">/** Specify properties for the specified authMechanism as a comma-separated list of colon-separated key-value pairs. */</span>
<a name="l184"><span class="ln">184  </span></a>  <span class="s1">authMechanismProperties</span><span class="s2">?: </span><span class="s1">AuthMechanismProperties</span><span class="s2">;</span>
<a name="l185"><span class="ln">185  </span></a>  <span class="s4">/** The size (in milliseconds) of the latency window for selecting among multiple suitable MongoDB instances. */</span>
<a name="l186"><span class="ln">186  </span></a>  <span class="s1">localThresholdMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l187"><span class="ln">187  </span></a>  <span class="s4">/** Specifies how long (in milliseconds) to block for server selection before throwing an exception.  */</span>
<a name="l188"><span class="ln">188  </span></a>  <span class="s1">serverSelectionTimeoutMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l189"><span class="ln">189  </span></a>  <span class="s4">/** heartbeatFrequencyMS controls when the driver checks the state of the MongoDB deployment. Specify the interval (in milliseconds) between checks, counted from the end of the previous check until the beginning of the next one. */</span>
<a name="l190"><span class="ln">190  </span></a>  <span class="s1">heartbeatFrequencyMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l191"><span class="ln">191  </span></a>  <span class="s4">/** Sets the minimum heartbeat frequency. In the event that the driver has to frequently re-check a server's availability, it will wait at least this long since the previous check to avoid wasted effort. */</span>
<a name="l192"><span class="ln">192  </span></a>  <span class="s1">minHeartbeatFrequencyMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l193"><span class="ln">193  </span></a>  <span class="s4">/** The name of the application that created this MongoClient instance. MongoDB 3.4 and newer will print this value in the server log upon establishing each connection. It is also recorded in the slow query log and profile collections */</span>
<a name="l194"><span class="ln">194  </span></a>  <span class="s1">appName</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l195"><span class="ln">195  </span></a>  <span class="s4">/** Enables retryable reads. */</span>
<a name="l196"><span class="ln">196  </span></a>  <span class="s1">retryReads</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l197"><span class="ln">197  </span></a>  <span class="s4">/** Enable retryable writes. */</span>
<a name="l198"><span class="ln">198  </span></a>  <span class="s1">retryWrites</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l199"><span class="ln">199  </span></a>  <span class="s4">/** Allow a driver to force a Single topology type with a connection string containing one host */</span>
<a name="l200"><span class="ln">200  </span></a>  <span class="s1">directConnection</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l201"><span class="ln">201  </span></a>  <span class="s4">/** Instruct the driver it is connecting to a load balancer fronting a mongos like service */</span>
<a name="l202"><span class="ln">202  </span></a>  <span class="s1">loadBalanced</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l203"><span class="ln">203  </span></a>  <span class="s4">/**</span>
<a name="l204"><span class="ln">204  </span></a>   <span class="s4">* The write concern w value</span>
<a name="l205"><span class="ln">205  </span></a>   <span class="s4">* </span><span class="s5">@deprecated </span><span class="s4">Please use the `writeConcern` option instead</span>
<a name="l206"><span class="ln">206  </span></a>   <span class="s4">*/</span>
<a name="l207"><span class="ln">207  </span></a>  <span class="s1">w</span><span class="s2">?: </span><span class="s1">W</span><span class="s2">;</span>
<a name="l208"><span class="ln">208  </span></a>  <span class="s4">/**</span>
<a name="l209"><span class="ln">209  </span></a>   <span class="s4">* The write concern timeout</span>
<a name="l210"><span class="ln">210  </span></a>   <span class="s4">* </span><span class="s5">@deprecated </span><span class="s4">Please use the `writeConcern` option instead</span>
<a name="l211"><span class="ln">211  </span></a>   <span class="s4">*/</span>
<a name="l212"><span class="ln">212  </span></a>  <span class="s1">wtimeoutMS</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l213"><span class="ln">213  </span></a>  <span class="s4">/**</span>
<a name="l214"><span class="ln">214  </span></a>   <span class="s4">* The journal write concern</span>
<a name="l215"><span class="ln">215  </span></a>   <span class="s4">* </span><span class="s5">@deprecated </span><span class="s4">Please use the `writeConcern` option instead</span>
<a name="l216"><span class="ln">216  </span></a>   <span class="s4">*/</span>
<a name="l217"><span class="ln">217  </span></a>  <span class="s1">journal</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l218"><span class="ln">218  </span></a>  <span class="s4">/**</span>
<a name="l219"><span class="ln">219  </span></a>   <span class="s4">* A MongoDB WriteConcern, which describes the level of acknowledgement</span>
<a name="l220"><span class="ln">220  </span></a>   <span class="s4">* requested from MongoDB for write operations.</span>
<a name="l221"><span class="ln">221  </span></a>   <span class="s4">*</span>
<a name="l222"><span class="ln">222  </span></a>   <span class="s4">* </span><span class="s5">@see </span><span class="s4">https://www.mongodb.com/docs/manual/reference/write-concern/</span>
<a name="l223"><span class="ln">223  </span></a>   <span class="s4">*/</span>
<a name="l224"><span class="ln">224  </span></a>  <span class="s1">writeConcern</span><span class="s2">?: </span><span class="s1">WriteConcern </span><span class="s2">| </span><span class="s1">WriteConcernSettings</span><span class="s2">;</span>
<a name="l225"><span class="ln">225  </span></a>  <span class="s4">/** TCP Connection no delay */</span>
<a name="l226"><span class="ln">226  </span></a>  <span class="s1">noDelay</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l227"><span class="ln">227  </span></a>  <span class="s4">/** Force server to assign `_id` values instead of driver */</span>
<a name="l228"><span class="ln">228  </span></a>  <span class="s1">forceServerObjectId</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l229"><span class="ln">229  </span></a>  <span class="s4">/** A primary key factory function for generation of custom `_id` keys */</span>
<a name="l230"><span class="ln">230  </span></a>  <span class="s1">pkFactory</span><span class="s2">?: </span><span class="s1">PkFactory</span><span class="s2">;</span>
<a name="l231"><span class="ln">231  </span></a>  <span class="s4">/** Enable command monitoring for this client */</span>
<a name="l232"><span class="ln">232  </span></a>  <span class="s1">monitorCommands</span><span class="s2">?: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l233"><span class="ln">233  </span></a>  <span class="s4">/** Server API version */</span>
<a name="l234"><span class="ln">234  </span></a>  <span class="s1">serverApi</span><span class="s2">?: </span><span class="s1">ServerApi </span><span class="s2">| </span><span class="s1">ServerApiVersion</span><span class="s2">;</span>
<a name="l235"><span class="ln">235  </span></a>  <span class="s4">/**</span>
<a name="l236"><span class="ln">236  </span></a>   <span class="s4">* Optionally enable in-use auto encryption</span>
<a name="l237"><span class="ln">237  </span></a>   <span class="s4">*</span>
<a name="l238"><span class="ln">238  </span></a>   <span class="s4">* </span><span class="s5">@remarks</span>
<a name="l239"><span class="ln">239  </span></a>   <span class="s4">*  Automatic encryption is an enterprise only feature that only applies to operations on a collection. Automatic encryption is not supported for operations on a database or view, and operations that are not bypassed will result in error</span>
<a name="l240"><span class="ln">240  </span></a>   <span class="s4">*  (see [libmongocrypt: Auto Encryption Allow-List](https://github.com/mongodb/specifications/blob/master/source/client-side-encryption/client-side-encryption.rst#libmongocrypt-auto-encryption-allow-list)). To bypass automatic encryption for all operations, set bypassAutoEncryption=true in AutoEncryptionOpts.</span>
<a name="l241"><span class="ln">241  </span></a>   <span class="s4">*</span>
<a name="l242"><span class="ln">242  </span></a>   <span class="s4">*  Automatic encryption requires the authenticated user to have the [listCollections privilege action](https://www.mongodb.com/docs/manual/reference/command/listCollections/#dbcmd.listCollections).</span>
<a name="l243"><span class="ln">243  </span></a>   <span class="s4">*</span>
<a name="l244"><span class="ln">244  </span></a>   <span class="s4">*  If a MongoClient with a limited connection pool size (i.e a non-zero maxPoolSize) is configured with AutoEncryptionOptions, a separate internal MongoClient is created if any of the following are true:</span>
<a name="l245"><span class="ln">245  </span></a>   <span class="s4">*  - AutoEncryptionOptions.keyVaultClient is not passed.</span>
<a name="l246"><span class="ln">246  </span></a>   <span class="s4">*  - AutoEncryptionOptions.bypassAutomaticEncryption is false.</span>
<a name="l247"><span class="ln">247  </span></a>   <span class="s4">*</span>
<a name="l248"><span class="ln">248  </span></a>   <span class="s4">* If an internal MongoClient is created, it is configured with the same options as the parent MongoClient except minPoolSize is set to 0 and AutoEncryptionOptions is omitted.</span>
<a name="l249"><span class="ln">249  </span></a>   <span class="s4">*/</span>
<a name="l250"><span class="ln">250  </span></a>  <span class="s1">autoEncryption</span><span class="s2">?: </span><span class="s1">AutoEncryptionOptions</span><span class="s2">;</span>
<a name="l251"><span class="ln">251  </span></a>  <span class="s4">/** Allows a wrapping driver to amend the client metadata generated by the driver to include information about the wrapping driver */</span>
<a name="l252"><span class="ln">252  </span></a>  <span class="s1">driverInfo</span><span class="s2">?: </span><span class="s1">DriverInfo</span><span class="s2">;</span>
<a name="l253"><span class="ln">253  </span></a>  <span class="s4">/** Configures a Socks5 proxy host used for creating TCP connections. */</span>
<a name="l254"><span class="ln">254  </span></a>  <span class="s1">proxyHost</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l255"><span class="ln">255  </span></a>  <span class="s4">/** Configures a Socks5 proxy port used for creating TCP connections. */</span>
<a name="l256"><span class="ln">256  </span></a>  <span class="s1">proxyPort</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l257"><span class="ln">257  </span></a>  <span class="s4">/** Configures a Socks5 proxy username when the proxy in proxyHost requires username/password authentication. */</span>
<a name="l258"><span class="ln">258  </span></a>  <span class="s1">proxyUsername</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l259"><span class="ln">259  </span></a>  <span class="s4">/** Configures a Socks5 proxy password when the proxy in proxyHost requires username/password authentication. */</span>
<a name="l260"><span class="ln">260  </span></a>  <span class="s1">proxyPassword</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l261"><span class="ln">261  </span></a>  <span class="s4">/** Instructs the driver monitors to use a specific monitoring mode */</span>
<a name="l262"><span class="ln">262  </span></a>  <span class="s1">serverMonitoringMode</span><span class="s2">?: </span><span class="s1">ServerMonitoringMode</span><span class="s2">;</span>
<a name="l263"><span class="ln">263  </span></a>
<a name="l264"><span class="ln">264  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l265"><span class="ln">265  </span></a>  <span class="s1">srvPoller</span><span class="s2">?: </span><span class="s1">SrvPoller</span><span class="s2">;</span>
<a name="l266"><span class="ln">266  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l267"><span class="ln">267  </span></a>  <span class="s1">connectionType</span><span class="s2">?: </span><span class="s0">typeof </span><span class="s1">Connection</span><span class="s2">;</span>
<a name="l268"><span class="ln">268  </span></a>  <span class="s4">/**</span>
<a name="l269"><span class="ln">269  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l270"><span class="ln">270  </span></a>   <span class="s4">* TODO: NODE-5671 - remove internal flag</span>
<a name="l271"><span class="ln">271  </span></a>   <span class="s4">*/</span>
<a name="l272"><span class="ln">272  </span></a>  <span class="s1">mongodbLogPath</span><span class="s2">?: </span><span class="s3">'stderr' </span><span class="s2">| </span><span class="s3">'stdout' </span><span class="s2">| </span><span class="s1">MongoDBLogWritable</span><span class="s2">;</span>
<a name="l273"><span class="ln">273  </span></a>  <span class="s4">/**</span>
<a name="l274"><span class="ln">274  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l275"><span class="ln">275  </span></a>   <span class="s4">* TODO: NODE-5671 - remove internal flag</span>
<a name="l276"><span class="ln">276  </span></a>   <span class="s4">*/</span>
<a name="l277"><span class="ln">277  </span></a>  <span class="s1">mongodbLogComponentSeverities</span><span class="s2">?: </span><span class="s1">LogComponentSeveritiesClientOptions</span><span class="s2">;</span>
<a name="l278"><span class="ln">278  </span></a>  <span class="s4">/**</span>
<a name="l279"><span class="ln">279  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l280"><span class="ln">280  </span></a>   <span class="s4">* TODO: NODE-5671 - remove internal flag</span>
<a name="l281"><span class="ln">281  </span></a>   <span class="s4">*/</span>
<a name="l282"><span class="ln">282  </span></a>  <span class="s1">mongodbLogMaxDocumentLength</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l283"><span class="ln">283  </span></a>
<a name="l284"><span class="ln">284  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l285"><span class="ln">285  </span></a>  <span class="s2">[</span><span class="s1">featureFlag</span><span class="s2">: </span><span class="s1">symbol</span><span class="s2">]: </span><span class="s1">any</span><span class="s2">;</span>
<a name="l286"><span class="ln">286  </span></a><span class="s2">}</span>
<a name="l287"><span class="ln">287  </span></a>
<a name="l288"><span class="ln">288  </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l289"><span class="ln">289  </span></a><span class="s0">export </span><span class="s1">type WithSessionCallback</span><span class="s2">&lt;</span><span class="s1">T </span><span class="s2">= </span><span class="s1">unknown</span><span class="s2">&gt; = (</span><span class="s1">session</span><span class="s2">: </span><span class="s1">ClientSession</span><span class="s2">) =&gt; </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;;</span>
<a name="l290"><span class="ln">290  </span></a>
<a name="l291"><span class="ln">291  </span></a><span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l292"><span class="ln">292  </span></a><span class="s0">export interface </span><span class="s1">MongoClientPrivate </span><span class="s2">{</span>
<a name="l293"><span class="ln">293  </span></a>  <span class="s1">url</span><span class="s2">: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l294"><span class="ln">294  </span></a>  <span class="s1">bsonOptions</span><span class="s2">: </span><span class="s1">BSONSerializeOptions</span><span class="s2">;</span>
<a name="l295"><span class="ln">295  </span></a>  <span class="s1">namespace</span><span class="s2">: </span><span class="s1">MongoDBNamespace</span><span class="s2">;</span>
<a name="l296"><span class="ln">296  </span></a>  <span class="s1">hasBeenClosed</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l297"><span class="ln">297  </span></a>  <span class="s4">/**</span>
<a name="l298"><span class="ln">298  </span></a>   <span class="s4">* We keep a reference to the sessions that are acquired from the pool.</span>
<a name="l299"><span class="ln">299  </span></a>   <span class="s4">* - used to track and close all sessions in client.close() (which is non-standard behavior)</span>
<a name="l300"><span class="ln">300  </span></a>   <span class="s4">* - used to notify the leak checker in our tests if test author forgot to clean up explicit sessions</span>
<a name="l301"><span class="ln">301  </span></a>   <span class="s4">*/</span>
<a name="l302"><span class="ln">302  </span></a>  <span class="s1">readonly activeSessions</span><span class="s2">: </span><span class="s1">Set</span><span class="s2">&lt;</span><span class="s1">ClientSession</span><span class="s2">&gt;;</span>
<a name="l303"><span class="ln">303  </span></a>  <span class="s1">readonly sessionPool</span><span class="s2">: </span><span class="s1">ServerSessionPool</span><span class="s2">;</span>
<a name="l304"><span class="ln">304  </span></a>  <span class="s1">readonly options</span><span class="s2">: </span><span class="s1">MongoOptions</span><span class="s2">;</span>
<a name="l305"><span class="ln">305  </span></a>  <span class="s1">readonly readConcern</span><span class="s2">?: </span><span class="s1">ReadConcern</span><span class="s2">;</span>
<a name="l306"><span class="ln">306  </span></a>  <span class="s1">readonly writeConcern</span><span class="s2">?: </span><span class="s1">WriteConcern</span><span class="s2">;</span>
<a name="l307"><span class="ln">307  </span></a>  <span class="s1">readonly readPreference</span><span class="s2">: </span><span class="s1">ReadPreference</span><span class="s2">;</span>
<a name="l308"><span class="ln">308  </span></a>  <span class="s1">readonly isMongoClient</span><span class="s2">: </span><span class="s0">true</span><span class="s2">;</span>
<a name="l309"><span class="ln">309  </span></a><span class="s2">}</span>
<a name="l310"><span class="ln">310  </span></a>
<a name="l311"><span class="ln">311  </span></a><span class="s4">/** </span><span class="s5">@public </span><span class="s4">*/</span>
<a name="l312"><span class="ln">312  </span></a><span class="s0">export </span><span class="s1">type MongoClientEvents </span><span class="s2">= </span><span class="s1">Pick</span><span class="s2">&lt;</span><span class="s1">TopologyEvents</span><span class="s2">, (</span><span class="s0">typeof </span><span class="s1">MONGO_CLIENT_EVENTS</span><span class="s2">)[</span><span class="s1">number</span><span class="s2">]&gt; &amp; {</span>
<a name="l313"><span class="ln">313  </span></a>  <span class="s6">// In previous versions the open event emitted a topology, in an effort to no longer</span>
<a name="l314"><span class="ln">314  </span></a>  <span class="s6">// expose internals but continue to expose this useful event API, it now emits a mongoClient</span>
<a name="l315"><span class="ln">315  </span></a>  <span class="s1">open</span><span class="s2">(</span><span class="s1">mongoClient</span><span class="s2">: </span><span class="s1">MongoClient</span><span class="s2">): </span><span class="s0">void</span><span class="s2">;</span>
<a name="l316"><span class="ln">316  </span></a><span class="s2">};</span>
<a name="l317"><span class="ln">317  </span></a>
<a name="l318"><span class="ln">318  </span></a><span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l319"><span class="ln">319  </span></a><span class="s0">const </span><span class="s1">kOptions </span><span class="s2">= </span><span class="s1">Symbol</span><span class="s2">(</span><span class="s3">'options'</span><span class="s2">);</span>
<a name="l320"><span class="ln">320  </span></a>
<a name="l321"><span class="ln">321  </span></a><span class="s4">/**</span>
<a name="l322"><span class="ln">322  </span></a> <span class="s4">* The **MongoClient** class is a class that allows for making Connections to MongoDB.</span>
<a name="l323"><span class="ln">323  </span></a> <span class="s4">* </span><span class="s5">@public</span>
<a name="l324"><span class="ln">324  </span></a> <span class="s4">*</span>
<a name="l325"><span class="ln">325  </span></a> <span class="s4">* </span><span class="s5">@remarks</span>
<a name="l326"><span class="ln">326  </span></a> <span class="s4">* The programmatically provided options take precedence over the URI options.</span>
<a name="l327"><span class="ln">327  </span></a> <span class="s4">*</span>
<a name="l328"><span class="ln">328  </span></a> <span class="s4">* </span><span class="s5">@example</span>
<a name="l329"><span class="ln">329  </span></a> <span class="s4">* ```ts</span>
<a name="l330"><span class="ln">330  </span></a> <span class="s4">* import { MongoClient } from 'mongodb';</span>
<a name="l331"><span class="ln">331  </span></a> <span class="s4">*</span>
<a name="l332"><span class="ln">332  </span></a> <span class="s4">* // Enable command monitoring for debugging</span>
<a name="l333"><span class="ln">333  </span></a> <span class="s4">* const client = new MongoClient('mongodb://localhost:27017', { monitorCommands: true });</span>
<a name="l334"><span class="ln">334  </span></a> <span class="s4">*</span>
<a name="l335"><span class="ln">335  </span></a> <span class="s4">* client.on('commandStarted', started =&gt; console.log(started));</span>
<a name="l336"><span class="ln">336  </span></a> <span class="s4">* client.db().collection('pets');</span>
<a name="l337"><span class="ln">337  </span></a> <span class="s4">* await client.insertOne({ name: 'spot', kind: 'dog' });</span>
<a name="l338"><span class="ln">338  </span></a> <span class="s4">* ```</span>
<a name="l339"><span class="ln">339  </span></a> <span class="s4">*/</span>
<a name="l340"><span class="ln">340  </span></a><span class="s0">export class </span><span class="s1">MongoClient </span><span class="s0">extends </span><span class="s1">TypedEventEmitter</span><span class="s2">&lt;</span><span class="s1">MongoClientEvents</span><span class="s2">&gt; {</span>
<a name="l341"><span class="ln">341  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l342"><span class="ln">342  </span></a>  <span class="s1">s</span><span class="s2">: </span><span class="s1">MongoClientPrivate</span><span class="s2">;</span>
<a name="l343"><span class="ln">343  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l344"><span class="ln">344  </span></a>  <span class="s1">topology</span><span class="s2">?: </span><span class="s1">Topology</span><span class="s2">;</span>
<a name="l345"><span class="ln">345  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l346"><span class="ln">346  </span></a>  <span class="s1">override readonly mongoLogger</span><span class="s2">: </span><span class="s1">MongoLogger</span><span class="s2">;</span>
<a name="l347"><span class="ln">347  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l348"><span class="ln">348  </span></a>  <span class="s0">private </span><span class="s1">connectionLock</span><span class="s2">?: </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s0">this</span><span class="s2">&gt;;</span>
<a name="l349"><span class="ln">349  </span></a>
<a name="l350"><span class="ln">350  </span></a>  <span class="s4">/**</span>
<a name="l351"><span class="ln">351  </span></a>   <span class="s4">* The consolidate, parsed, transformed and merged options.</span>
<a name="l352"><span class="ln">352  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l353"><span class="ln">353  </span></a>   <span class="s4">*/</span>
<a name="l354"><span class="ln">354  </span></a>  <span class="s2">[</span><span class="s1">kOptions</span><span class="s2">]: </span><span class="s1">MongoOptions</span><span class="s2">;</span>
<a name="l355"><span class="ln">355  </span></a>
<a name="l356"><span class="ln">356  </span></a>  <span class="s1">constructor</span><span class="s2">(</span><span class="s1">url</span><span class="s2">: </span><span class="s1">string</span><span class="s2">, </span><span class="s1">options</span><span class="s2">?: </span><span class="s1">MongoClientOptions</span><span class="s2">) {</span>
<a name="l357"><span class="ln">357  </span></a>    <span class="s0">super</span><span class="s2">();</span>
<a name="l358"><span class="ln">358  </span></a>
<a name="l359"><span class="ln">359  </span></a>    <span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">] = </span><span class="s1">parseOptions</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s0">this</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
<a name="l360"><span class="ln">360  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">mongoLogger </span><span class="s2">= </span><span class="s0">new </span><span class="s1">MongoLogger</span><span class="s2">(</span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">mongoLoggerOptions</span><span class="s2">);</span>
<a name="l361"><span class="ln">361  </span></a>
<a name="l362"><span class="ln">362  </span></a>    <span class="s6">// eslint-disable-next-line @typescript-eslint/no-this-alias</span>
<a name="l363"><span class="ln">363  </span></a>    <span class="s0">const </span><span class="s1">client </span><span class="s2">= </span><span class="s0">this</span><span class="s2">;</span>
<a name="l364"><span class="ln">364  </span></a>
<a name="l365"><span class="ln">365  </span></a>    <span class="s6">// The internal state</span>
<a name="l366"><span class="ln">366  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">s </span><span class="s2">= {</span>
<a name="l367"><span class="ln">367  </span></a>      <span class="s1">url</span><span class="s2">,</span>
<a name="l368"><span class="ln">368  </span></a>      <span class="s1">bsonOptions</span><span class="s2">: </span><span class="s1">resolveBSONOptions</span><span class="s2">(</span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">]),</span>
<a name="l369"><span class="ln">369  </span></a>      <span class="s1">namespace</span><span class="s2">: </span><span class="s1">ns</span><span class="s2">(</span><span class="s3">'admin'</span><span class="s2">),</span>
<a name="l370"><span class="ln">370  </span></a>      <span class="s1">hasBeenClosed</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
<a name="l371"><span class="ln">371  </span></a>      <span class="s1">sessionPool</span><span class="s2">: </span><span class="s0">new </span><span class="s1">ServerSessionPool</span><span class="s2">(</span><span class="s0">this</span><span class="s2">),</span>
<a name="l372"><span class="ln">372  </span></a>      <span class="s1">activeSessions</span><span class="s2">: </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">(),</span>
<a name="l373"><span class="ln">373  </span></a>
<a name="l374"><span class="ln">374  </span></a>      <span class="s1">get options</span><span class="s2">() {</span>
<a name="l375"><span class="ln">375  </span></a>        <span class="s0">return </span><span class="s1">client</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">];</span>
<a name="l376"><span class="ln">376  </span></a>      <span class="s2">},</span>
<a name="l377"><span class="ln">377  </span></a>      <span class="s1">get readConcern</span><span class="s2">() {</span>
<a name="l378"><span class="ln">378  </span></a>        <span class="s0">return </span><span class="s1">client</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">readConcern</span><span class="s2">;</span>
<a name="l379"><span class="ln">379  </span></a>      <span class="s2">},</span>
<a name="l380"><span class="ln">380  </span></a>      <span class="s1">get writeConcern</span><span class="s2">() {</span>
<a name="l381"><span class="ln">381  </span></a>        <span class="s0">return </span><span class="s1">client</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">writeConcern</span><span class="s2">;</span>
<a name="l382"><span class="ln">382  </span></a>      <span class="s2">},</span>
<a name="l383"><span class="ln">383  </span></a>      <span class="s1">get readPreference</span><span class="s2">() {</span>
<a name="l384"><span class="ln">384  </span></a>        <span class="s0">return </span><span class="s1">client</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">readPreference</span><span class="s2">;</span>
<a name="l385"><span class="ln">385  </span></a>      <span class="s2">},</span>
<a name="l386"><span class="ln">386  </span></a>      <span class="s1">get isMongoClient</span><span class="s2">(): </span><span class="s0">true </span><span class="s2">{</span>
<a name="l387"><span class="ln">387  </span></a>        <span class="s0">return true</span><span class="s2">;</span>
<a name="l388"><span class="ln">388  </span></a>      <span class="s2">}</span>
<a name="l389"><span class="ln">389  </span></a>    <span class="s2">};</span>
<a name="l390"><span class="ln">390  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">checkForNonGenuineHosts</span><span class="s2">();</span>
<a name="l391"><span class="ln">391  </span></a>  <span class="s2">}</span>
<a name="l392"><span class="ln">392  </span></a>
<a name="l393"><span class="ln">393  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l394"><span class="ln">394  </span></a>  <span class="s0">private </span><span class="s1">checkForNonGenuineHosts</span><span class="s2">() {</span>
<a name="l395"><span class="ln">395  </span></a>    <span class="s0">const </span><span class="s1">documentDBHostnames </span><span class="s2">= </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">hosts</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">((</span><span class="s1">hostAddress</span><span class="s2">: </span><span class="s1">HostAddress</span><span class="s2">) =&gt;</span>
<a name="l396"><span class="ln">396  </span></a>      <span class="s1">isHostMatch</span><span class="s2">(</span><span class="s1">DOCUMENT_DB_CHECK</span><span class="s2">, </span><span class="s1">hostAddress</span><span class="s2">.</span><span class="s1">host</span><span class="s2">)</span>
<a name="l397"><span class="ln">397  </span></a>    <span class="s2">);</span>
<a name="l398"><span class="ln">398  </span></a>    <span class="s0">const </span><span class="s1">srvHostIsDocumentDB </span><span class="s2">= </span><span class="s1">isHostMatch</span><span class="s2">(</span><span class="s1">DOCUMENT_DB_CHECK</span><span class="s2">, </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">srvHost</span><span class="s2">);</span>
<a name="l399"><span class="ln">399  </span></a>
<a name="l400"><span class="ln">400  </span></a>    <span class="s0">const </span><span class="s1">cosmosDBHostnames </span><span class="s2">= </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">hosts</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">((</span><span class="s1">hostAddress</span><span class="s2">: </span><span class="s1">HostAddress</span><span class="s2">) =&gt;</span>
<a name="l401"><span class="ln">401  </span></a>      <span class="s1">isHostMatch</span><span class="s2">(</span><span class="s1">COSMOS_DB_CHECK</span><span class="s2">, </span><span class="s1">hostAddress</span><span class="s2">.</span><span class="s1">host</span><span class="s2">)</span>
<a name="l402"><span class="ln">402  </span></a>    <span class="s2">);</span>
<a name="l403"><span class="ln">403  </span></a>    <span class="s0">const </span><span class="s1">srvHostIsCosmosDB </span><span class="s2">= </span><span class="s1">isHostMatch</span><span class="s2">(</span><span class="s1">COSMOS_DB_CHECK</span><span class="s2">, </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">srvHost</span><span class="s2">);</span>
<a name="l404"><span class="ln">404  </span></a>
<a name="l405"><span class="ln">405  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s1">documentDBHostnames</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!== </span><span class="s7">0 </span><span class="s2">|| </span><span class="s1">srvHostIsDocumentDB</span><span class="s2">) {</span>
<a name="l406"><span class="ln">406  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">mongoLogger</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span><span class="s3">'client'</span><span class="s2">, </span><span class="s1">DOCUMENT_DB_MSG</span><span class="s2">);</span>
<a name="l407"><span class="ln">407  </span></a>    <span class="s2">} </span><span class="s0">else if </span><span class="s2">(</span><span class="s1">cosmosDBHostnames</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!== </span><span class="s7">0 </span><span class="s2">|| </span><span class="s1">srvHostIsCosmosDB</span><span class="s2">) {</span>
<a name="l408"><span class="ln">408  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">mongoLogger</span><span class="s2">.</span><span class="s1">info</span><span class="s2">(</span><span class="s3">'client'</span><span class="s2">, </span><span class="s1">COSMOS_DB_MSG</span><span class="s2">);</span>
<a name="l409"><span class="ln">409  </span></a>    <span class="s2">}</span>
<a name="l410"><span class="ln">410  </span></a>  <span class="s2">}</span>
<a name="l411"><span class="ln">411  </span></a>
<a name="l412"><span class="ln">412  </span></a>  <span class="s4">/** </span><span class="s5">@see </span><span class="s4">MongoOptions */</span>
<a name="l413"><span class="ln">413  </span></a>  <span class="s1">get options</span><span class="s2">(): </span><span class="s1">Readonly</span><span class="s2">&lt;</span><span class="s1">MongoOptions</span><span class="s2">&gt; {</span>
<a name="l414"><span class="ln">414  </span></a>    <span class="s0">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze</span><span class="s2">({ </span><span class="s1">...</span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">] });</span>
<a name="l415"><span class="ln">415  </span></a>  <span class="s2">}</span>
<a name="l416"><span class="ln">416  </span></a>
<a name="l417"><span class="ln">417  </span></a>  <span class="s1">get serverApi</span><span class="s2">(): </span><span class="s1">Readonly</span><span class="s2">&lt;</span><span class="s1">ServerApi </span><span class="s2">| </span><span class="s1">undefined</span><span class="s2">&gt; {</span>
<a name="l418"><span class="ln">418  </span></a>    <span class="s0">return this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">serverApi </span><span class="s2">&amp;&amp; </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze</span><span class="s2">({ </span><span class="s1">...</span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">serverApi </span><span class="s2">});</span>
<a name="l419"><span class="ln">419  </span></a>  <span class="s2">}</span>
<a name="l420"><span class="ln">420  </span></a>  <span class="s4">/**</span>
<a name="l421"><span class="ln">421  </span></a>   <span class="s4">* Intended for APM use only</span>
<a name="l422"><span class="ln">422  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l423"><span class="ln">423  </span></a>   <span class="s4">*/</span>
<a name="l424"><span class="ln">424  </span></a>  <span class="s1">get monitorCommands</span><span class="s2">(): </span><span class="s1">boolean </span><span class="s2">{</span>
<a name="l425"><span class="ln">425  </span></a>    <span class="s0">return this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">monitorCommands</span><span class="s2">;</span>
<a name="l426"><span class="ln">426  </span></a>  <span class="s2">}</span>
<a name="l427"><span class="ln">427  </span></a>  <span class="s1">set monitorCommands</span><span class="s2">(</span><span class="s1">value</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">) {</span>
<a name="l428"><span class="ln">428  </span></a>    <span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">monitorCommands </span><span class="s2">= </span><span class="s1">value</span><span class="s2">;</span>
<a name="l429"><span class="ln">429  </span></a>  <span class="s2">}</span>
<a name="l430"><span class="ln">430  </span></a>
<a name="l431"><span class="ln">431  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l432"><span class="ln">432  </span></a>  <span class="s1">get autoEncrypter</span><span class="s2">(): </span><span class="s1">AutoEncrypter </span><span class="s2">| </span><span class="s1">undefined </span><span class="s2">{</span>
<a name="l433"><span class="ln">433  </span></a>    <span class="s0">return this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">].</span><span class="s1">autoEncrypter</span><span class="s2">;</span>
<a name="l434"><span class="ln">434  </span></a>  <span class="s2">}</span>
<a name="l435"><span class="ln">435  </span></a>
<a name="l436"><span class="ln">436  </span></a>  <span class="s1">get readConcern</span><span class="s2">(): </span><span class="s1">ReadConcern </span><span class="s2">| </span><span class="s1">undefined </span><span class="s2">{</span>
<a name="l437"><span class="ln">437  </span></a>    <span class="s0">return this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">readConcern</span><span class="s2">;</span>
<a name="l438"><span class="ln">438  </span></a>  <span class="s2">}</span>
<a name="l439"><span class="ln">439  </span></a>
<a name="l440"><span class="ln">440  </span></a>  <span class="s1">get writeConcern</span><span class="s2">(): </span><span class="s1">WriteConcern </span><span class="s2">| </span><span class="s1">undefined </span><span class="s2">{</span>
<a name="l441"><span class="ln">441  </span></a>    <span class="s0">return this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">writeConcern</span><span class="s2">;</span>
<a name="l442"><span class="ln">442  </span></a>  <span class="s2">}</span>
<a name="l443"><span class="ln">443  </span></a>
<a name="l444"><span class="ln">444  </span></a>  <span class="s1">get readPreference</span><span class="s2">(): </span><span class="s1">ReadPreference </span><span class="s2">{</span>
<a name="l445"><span class="ln">445  </span></a>    <span class="s0">return this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">readPreference</span><span class="s2">;</span>
<a name="l446"><span class="ln">446  </span></a>  <span class="s2">}</span>
<a name="l447"><span class="ln">447  </span></a>
<a name="l448"><span class="ln">448  </span></a>  <span class="s1">get bsonOptions</span><span class="s2">(): </span><span class="s1">BSONSerializeOptions </span><span class="s2">{</span>
<a name="l449"><span class="ln">449  </span></a>    <span class="s0">return this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">bsonOptions</span><span class="s2">;</span>
<a name="l450"><span class="ln">450  </span></a>  <span class="s2">}</span>
<a name="l451"><span class="ln">451  </span></a>
<a name="l452"><span class="ln">452  </span></a>  <span class="s4">/**</span>
<a name="l453"><span class="ln">453  </span></a>   <span class="s4">* Connect to MongoDB using a url</span>
<a name="l454"><span class="ln">454  </span></a>   <span class="s4">*</span>
<a name="l455"><span class="ln">455  </span></a>   <span class="s4">* </span><span class="s5">@see </span><span class="s4">docs.mongodb.org/manual/reference/connection-string/</span>
<a name="l456"><span class="ln">456  </span></a>   <span class="s4">*/</span>
<a name="l457"><span class="ln">457  </span></a>  <span class="s1">async connect</span><span class="s2">(): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s0">this</span><span class="s2">&gt; {</span>
<a name="l458"><span class="ln">458  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">connectionLock</span><span class="s2">) {</span>
<a name="l459"><span class="ln">459  </span></a>      <span class="s0">return this</span><span class="s2">.</span><span class="s1">connectionLock</span><span class="s2">;</span>
<a name="l460"><span class="ln">460  </span></a>    <span class="s2">}</span>
<a name="l461"><span class="ln">461  </span></a>
<a name="l462"><span class="ln">462  </span></a>    <span class="s0">try </span><span class="s2">{</span>
<a name="l463"><span class="ln">463  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">connectionLock </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">_connect</span><span class="s2">();</span>
<a name="l464"><span class="ln">464  </span></a>      <span class="s0">await this</span><span class="s2">.</span><span class="s1">connectionLock</span><span class="s2">;</span>
<a name="l465"><span class="ln">465  </span></a>    <span class="s2">} </span><span class="s0">finally </span><span class="s2">{</span>
<a name="l466"><span class="ln">466  </span></a>      <span class="s6">// release</span>
<a name="l467"><span class="ln">467  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">connectionLock </span><span class="s2">= </span><span class="s1">undefined</span><span class="s2">;</span>
<a name="l468"><span class="ln">468  </span></a>    <span class="s2">}</span>
<a name="l469"><span class="ln">469  </span></a>
<a name="l470"><span class="ln">470  </span></a>    <span class="s0">return this</span><span class="s2">;</span>
<a name="l471"><span class="ln">471  </span></a>  <span class="s2">}</span>
<a name="l472"><span class="ln">472  </span></a>
<a name="l473"><span class="ln">473  </span></a>  <span class="s4">/**</span>
<a name="l474"><span class="ln">474  </span></a>   <span class="s4">* Create a topology to open the connection, must be locked to avoid topology leaks in concurrency scenario.</span>
<a name="l475"><span class="ln">475  </span></a>   <span class="s4">* Locking is enforced by the connect method.</span>
<a name="l476"><span class="ln">476  </span></a>   <span class="s4">*</span>
<a name="l477"><span class="ln">477  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l478"><span class="ln">478  </span></a>   <span class="s4">*/</span>
<a name="l479"><span class="ln">479  </span></a>  <span class="s0">private </span><span class="s1">async _connect</span><span class="s2">(): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s0">this</span><span class="s2">&gt; {</span>
<a name="l480"><span class="ln">480  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">topology </span><span class="s2">&amp;&amp; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">.</span><span class="s1">isConnected</span><span class="s2">()) {</span>
<a name="l481"><span class="ln">481  </span></a>      <span class="s0">return this</span><span class="s2">;</span>
<a name="l482"><span class="ln">482  </span></a>    <span class="s2">}</span>
<a name="l483"><span class="ln">483  </span></a>
<a name="l484"><span class="ln">484  </span></a>    <span class="s0">const </span><span class="s1">options </span><span class="s2">= </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">];</span>
<a name="l485"><span class="ln">485  </span></a>
<a name="l486"><span class="ln">486  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">tls</span><span class="s2">) {</span>
<a name="l487"><span class="ln">487  </span></a>      <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tlsCAFile </span><span class="s2">=== </span><span class="s3">'string'</span><span class="s2">) {</span>
<a name="l488"><span class="ln">488  </span></a>        <span class="s1">options</span><span class="s2">.</span><span class="s1">ca </span><span class="s2">??= </span><span class="s0">await </span><span class="s1">fs</span><span class="s2">.</span><span class="s1">readFile</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">tlsCAFile</span><span class="s2">);</span>
<a name="l489"><span class="ln">489  </span></a>      <span class="s2">}</span>
<a name="l490"><span class="ln">490  </span></a>      <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tlsCRLFile </span><span class="s2">=== </span><span class="s3">'string'</span><span class="s2">) {</span>
<a name="l491"><span class="ln">491  </span></a>        <span class="s1">options</span><span class="s2">.</span><span class="s1">crl </span><span class="s2">??= </span><span class="s0">await </span><span class="s1">fs</span><span class="s2">.</span><span class="s1">readFile</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">tlsCRLFile</span><span class="s2">);</span>
<a name="l492"><span class="ln">492  </span></a>      <span class="s2">}</span>
<a name="l493"><span class="ln">493  </span></a>      <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tlsCertificateKeyFile </span><span class="s2">=== </span><span class="s3">'string'</span><span class="s2">) {</span>
<a name="l494"><span class="ln">494  </span></a>        <span class="s0">if </span><span class="s2">(!</span><span class="s1">options</span><span class="s2">.</span><span class="s1">key </span><span class="s2">|| !</span><span class="s1">options</span><span class="s2">.</span><span class="s1">cert</span><span class="s2">) {</span>
<a name="l495"><span class="ln">495  </span></a>          <span class="s0">const </span><span class="s1">contents </span><span class="s2">= </span><span class="s0">await </span><span class="s1">fs</span><span class="s2">.</span><span class="s1">readFile</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">tlsCertificateKeyFile</span><span class="s2">);</span>
<a name="l496"><span class="ln">496  </span></a>          <span class="s1">options</span><span class="s2">.</span><span class="s1">key </span><span class="s2">??= </span><span class="s1">contents</span><span class="s2">;</span>
<a name="l497"><span class="ln">497  </span></a>          <span class="s1">options</span><span class="s2">.</span><span class="s1">cert </span><span class="s2">??= </span><span class="s1">contents</span><span class="s2">;</span>
<a name="l498"><span class="ln">498  </span></a>        <span class="s2">}</span>
<a name="l499"><span class="ln">499  </span></a>      <span class="s2">}</span>
<a name="l500"><span class="ln">500  </span></a>    <span class="s2">}</span>
<a name="l501"><span class="ln">501  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">srvHost </span><span class="s2">=== </span><span class="s3">'string'</span><span class="s2">) {</span>
<a name="l502"><span class="ln">502  </span></a>      <span class="s0">const </span><span class="s1">hosts </span><span class="s2">= </span><span class="s0">await </span><span class="s1">resolveSRVRecord</span><span class="s2">(</span><span class="s1">options</span><span class="s2">);</span>
<a name="l503"><span class="ln">503  </span></a>
<a name="l504"><span class="ln">504  </span></a>      <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s2">[</span><span class="s1">index</span><span class="s2">, </span><span class="s1">host</span><span class="s2">] </span><span class="s1">of hosts</span><span class="s2">.</span><span class="s1">entries</span><span class="s2">()) {</span>
<a name="l505"><span class="ln">505  </span></a>        <span class="s1">options</span><span class="s2">.</span><span class="s1">hosts</span><span class="s2">[</span><span class="s1">index</span><span class="s2">] = </span><span class="s1">host</span><span class="s2">;</span>
<a name="l506"><span class="ln">506  </span></a>      <span class="s2">}</span>
<a name="l507"><span class="ln">507  </span></a>    <span class="s2">}</span>
<a name="l508"><span class="ln">508  </span></a>
<a name="l509"><span class="ln">509  </span></a>    <span class="s6">// It is important to perform validation of hosts AFTER SRV resolution, to check the real hostname,</span>
<a name="l510"><span class="ln">510  </span></a>    <span class="s6">// but BEFORE we even attempt connecting with a potentially not allowed hostname</span>
<a name="l511"><span class="ln">511  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">credentials</span><span class="s2">?.</span><span class="s1">mechanism </span><span class="s2">=== </span><span class="s1">AuthMechanism</span><span class="s2">.</span><span class="s1">MONGODB_OIDC</span><span class="s2">) {</span>
<a name="l512"><span class="ln">512  </span></a>      <span class="s0">const </span><span class="s1">allowedHosts </span><span class="s2">=</span>
<a name="l513"><span class="ln">513  </span></a>        <span class="s1">options</span><span class="s2">.</span><span class="s1">credentials</span><span class="s2">?.</span><span class="s1">mechanismProperties</span><span class="s2">?.</span><span class="s1">ALLOWED_HOSTS </span><span class="s2">|| </span><span class="s1">DEFAULT_ALLOWED_HOSTS</span><span class="s2">;</span>
<a name="l514"><span class="ln">514  </span></a>      <span class="s0">const </span><span class="s1">isServiceAuth </span><span class="s2">= !!</span><span class="s1">options</span><span class="s2">.</span><span class="s1">credentials</span><span class="s2">?.</span><span class="s1">mechanismProperties</span><span class="s2">?.</span><span class="s1">PROVIDER_NAME</span><span class="s2">;</span>
<a name="l515"><span class="ln">515  </span></a>      <span class="s0">if </span><span class="s2">(!</span><span class="s1">isServiceAuth</span><span class="s2">) {</span>
<a name="l516"><span class="ln">516  </span></a>        <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s1">host of options</span><span class="s2">.</span><span class="s1">hosts</span><span class="s2">) {</span>
<a name="l517"><span class="ln">517  </span></a>          <span class="s0">if </span><span class="s2">(!</span><span class="s1">hostMatchesWildcards</span><span class="s2">(</span><span class="s1">host</span><span class="s2">.</span><span class="s1">toHostPort</span><span class="s2">().</span><span class="s1">host</span><span class="s2">, </span><span class="s1">allowedHosts</span><span class="s2">)) {</span>
<a name="l518"><span class="ln">518  </span></a>            <span class="s0">throw new </span><span class="s1">MongoInvalidArgumentError</span><span class="s2">(</span>
<a name="l519"><span class="ln">519  </span></a>              <span class="s3">`Host '</span><span class="s1">$</span><span class="s2">{</span><span class="s1">host</span><span class="s2">}</span><span class="s3">' is not valid for OIDC authentication with ALLOWED_HOSTS of '</span><span class="s1">$</span><span class="s2">{</span><span class="s1">allowedHosts</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span>
<a name="l520"><span class="ln">520  </span></a>                <span class="s3">','</span>
<a name="l521"><span class="ln">521  </span></a>              <span class="s2">)}</span><span class="s3">'`</span>
<a name="l522"><span class="ln">522  </span></a>            <span class="s2">);</span>
<a name="l523"><span class="ln">523  </span></a>          <span class="s2">}</span>
<a name="l524"><span class="ln">524  </span></a>        <span class="s2">}</span>
<a name="l525"><span class="ln">525  </span></a>      <span class="s2">}</span>
<a name="l526"><span class="ln">526  </span></a>    <span class="s2">}</span>
<a name="l527"><span class="ln">527  </span></a>
<a name="l528"><span class="ln">528  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">topology </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Topology</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">options</span><span class="s2">.</span><span class="s1">hosts</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
<a name="l529"><span class="ln">529  </span></a>    <span class="s6">// Events can be emitted before initialization is complete so we have to</span>
<a name="l530"><span class="ln">530  </span></a>    <span class="s6">// save the reference to the topology on the client ASAP if the event handlers need to access it</span>
<a name="l531"><span class="ln">531  </span></a>
<a name="l532"><span class="ln">532  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">.</span><span class="s1">once</span><span class="s2">(</span><span class="s1">Topology</span><span class="s2">.</span><span class="s1">OPEN</span><span class="s2">, () =&gt; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">emit</span><span class="s2">(</span><span class="s3">'open'</span><span class="s2">, </span><span class="s0">this</span><span class="s2">));</span>
<a name="l533"><span class="ln">533  </span></a>
<a name="l534"><span class="ln">534  </span></a>    <span class="s0">for </span><span class="s2">(</span><span class="s0">const </span><span class="s1">event of MONGO_CLIENT_EVENTS</span><span class="s2">) {</span>
<a name="l535"><span class="ln">535  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">.</span><span class="s1">on</span><span class="s2">(</span><span class="s1">event</span><span class="s2">, (</span><span class="s1">...args</span><span class="s2">: </span><span class="s1">any</span><span class="s2">[]) =&gt; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">emit</span><span class="s2">(</span><span class="s1">event</span><span class="s2">, </span><span class="s1">...</span><span class="s2">(</span><span class="s1">args </span><span class="s2">as </span><span class="s1">any</span><span class="s2">)));</span>
<a name="l536"><span class="ln">536  </span></a>    <span class="s2">}</span>
<a name="l537"><span class="ln">537  </span></a>
<a name="l538"><span class="ln">538  </span></a>    <span class="s0">const </span><span class="s1">topologyConnect </span><span class="s2">= </span><span class="s1">async </span><span class="s2">() =&gt; {</span>
<a name="l539"><span class="ln">539  </span></a>      <span class="s0">try </span><span class="s2">{</span>
<a name="l540"><span class="ln">540  </span></a>        <span class="s0">await </span><span class="s1">promisify</span><span class="s2">(</span><span class="s1">callback </span><span class="s2">=&gt; </span><span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">?.</span><span class="s1">connect</span><span class="s2">(</span><span class="s1">options</span><span class="s2">, </span><span class="s1">callback</span><span class="s2">))();</span>
<a name="l541"><span class="ln">541  </span></a>      <span class="s2">} </span><span class="s0">catch </span><span class="s2">(</span><span class="s1">error</span><span class="s2">) {</span>
<a name="l542"><span class="ln">542  </span></a>        <span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">?.</span><span class="s1">close</span><span class="s2">({ </span><span class="s1">force</span><span class="s2">: </span><span class="s0">true </span><span class="s2">});</span>
<a name="l543"><span class="ln">543  </span></a>        <span class="s0">throw </span><span class="s1">error</span><span class="s2">;</span>
<a name="l544"><span class="ln">544  </span></a>      <span class="s2">}</span>
<a name="l545"><span class="ln">545  </span></a>    <span class="s2">};</span>
<a name="l546"><span class="ln">546  </span></a>
<a name="l547"><span class="ln">547  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">autoEncrypter</span><span class="s2">) {</span>
<a name="l548"><span class="ln">548  </span></a>      <span class="s0">await this</span><span class="s2">.</span><span class="s1">autoEncrypter</span><span class="s2">?.</span><span class="s1">init</span><span class="s2">();</span>
<a name="l549"><span class="ln">549  </span></a>      <span class="s0">await </span><span class="s1">topologyConnect</span><span class="s2">();</span>
<a name="l550"><span class="ln">550  </span></a>      <span class="s0">await </span><span class="s1">options</span><span class="s2">.</span><span class="s1">encrypter</span><span class="s2">.</span><span class="s1">connectInternalClient</span><span class="s2">();</span>
<a name="l551"><span class="ln">551  </span></a>    <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
<a name="l552"><span class="ln">552  </span></a>      <span class="s0">await </span><span class="s1">topologyConnect</span><span class="s2">();</span>
<a name="l553"><span class="ln">553  </span></a>    <span class="s2">}</span>
<a name="l554"><span class="ln">554  </span></a>
<a name="l555"><span class="ln">555  </span></a>    <span class="s0">return this</span><span class="s2">;</span>
<a name="l556"><span class="ln">556  </span></a>  <span class="s2">}</span>
<a name="l557"><span class="ln">557  </span></a>
<a name="l558"><span class="ln">558  </span></a>  <span class="s4">/**</span>
<a name="l559"><span class="ln">559  </span></a>   <span class="s4">* Close the client and its underlying connections</span>
<a name="l560"><span class="ln">560  </span></a>   <span class="s4">*</span>
<a name="l561"><span class="ln">561  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">force - Force close, emitting no events</span>
<a name="l562"><span class="ln">562  </span></a>   <span class="s4">*/</span>
<a name="l563"><span class="ln">563  </span></a>  <span class="s1">async close</span><span class="s2">(</span><span class="s1">force </span><span class="s2">= </span><span class="s0">false</span><span class="s2">): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s0">void</span><span class="s2">&gt; {</span>
<a name="l564"><span class="ln">564  </span></a>    <span class="s6">// There's no way to set hasBeenClosed back to false</span>
<a name="l565"><span class="ln">565  </span></a>    <span class="s1">Object</span><span class="s2">.</span><span class="s1">defineProperty</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">, </span><span class="s3">'hasBeenClosed'</span><span class="s2">, {</span>
<a name="l566"><span class="ln">566  </span></a>      <span class="s1">value</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>
<a name="l567"><span class="ln">567  </span></a>      <span class="s1">enumerable</span><span class="s2">: </span><span class="s0">true</span><span class="s2">,</span>
<a name="l568"><span class="ln">568  </span></a>      <span class="s1">configurable</span><span class="s2">: </span><span class="s0">false</span><span class="s2">,</span>
<a name="l569"><span class="ln">569  </span></a>      <span class="s1">writable</span><span class="s2">: </span><span class="s0">false</span>
<a name="l570"><span class="ln">570  </span></a>    <span class="s2">});</span>
<a name="l571"><span class="ln">571  </span></a>
<a name="l572"><span class="ln">572  </span></a>    <span class="s0">const </span><span class="s1">activeSessionEnds </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">activeSessions</span><span class="s2">, </span><span class="s1">session </span><span class="s2">=&gt; </span><span class="s1">session</span><span class="s2">.</span><span class="s1">endSession</span><span class="s2">());</span>
<a name="l573"><span class="ln">573  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">activeSessions</span><span class="s2">.</span><span class="s1">clear</span><span class="s2">();</span>
<a name="l574"><span class="ln">574  </span></a>
<a name="l575"><span class="ln">575  </span></a>    <span class="s0">await </span><span class="s1">Promise</span><span class="s2">.</span><span class="s1">all</span><span class="s2">(</span><span class="s1">activeSessionEnds</span><span class="s2">);</span>
<a name="l576"><span class="ln">576  </span></a>
<a name="l577"><span class="ln">577  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">topology </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
<a name="l578"><span class="ln">578  </span></a>      <span class="s0">return</span><span class="s2">;</span>
<a name="l579"><span class="ln">579  </span></a>    <span class="s2">}</span>
<a name="l580"><span class="ln">580  </span></a>
<a name="l581"><span class="ln">581  </span></a>    <span class="s6">// If we would attempt to select a server and get nothing back we short circuit</span>
<a name="l582"><span class="ln">582  </span></a>    <span class="s6">// to avoid the server selection timeout.</span>
<a name="l583"><span class="ln">583  </span></a>    <span class="s0">const </span><span class="s1">selector </span><span class="s2">= </span><span class="s1">readPreferenceServerSelector</span><span class="s2">(</span><span class="s1">ReadPreference</span><span class="s2">.</span><span class="s1">primaryPreferred</span><span class="s2">);</span>
<a name="l584"><span class="ln">584  </span></a>    <span class="s0">const </span><span class="s1">topologyDescription </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">.</span><span class="s1">description</span><span class="s2">;</span>
<a name="l585"><span class="ln">585  </span></a>    <span class="s0">const </span><span class="s1">serverDescriptions </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s1">topologyDescription</span><span class="s2">.</span><span class="s1">servers</span><span class="s2">.</span><span class="s1">values</span><span class="s2">());</span>
<a name="l586"><span class="ln">586  </span></a>    <span class="s0">const </span><span class="s1">servers </span><span class="s2">= </span><span class="s1">selector</span><span class="s2">(</span><span class="s1">topologyDescription</span><span class="s2">, </span><span class="s1">serverDescriptions</span><span class="s2">);</span>
<a name="l587"><span class="ln">587  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s1">servers</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!== </span><span class="s7">0</span><span class="s2">) {</span>
<a name="l588"><span class="ln">588  </span></a>      <span class="s0">const </span><span class="s1">endSessions </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">from</span><span class="s2">(</span><span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">sessionPool</span><span class="s2">.</span><span class="s1">sessions</span><span class="s2">, ({ </span><span class="s1">id </span><span class="s2">}) =&gt; </span><span class="s1">id</span><span class="s2">);</span>
<a name="l589"><span class="ln">589  </span></a>      <span class="s0">if </span><span class="s2">(</span><span class="s1">endSessions</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!== </span><span class="s7">0</span><span class="s2">) {</span>
<a name="l590"><span class="ln">590  </span></a>        <span class="s0">await </span><span class="s1">executeOperation</span><span class="s2">(</span>
<a name="l591"><span class="ln">591  </span></a>          <span class="s0">this</span><span class="s2">,</span>
<a name="l592"><span class="ln">592  </span></a>          <span class="s0">new </span><span class="s1">RunAdminCommandOperation</span><span class="s2">(</span>
<a name="l593"><span class="ln">593  </span></a>            <span class="s2">{ </span><span class="s1">endSessions </span><span class="s2">},</span>
<a name="l594"><span class="ln">594  </span></a>            <span class="s2">{ </span><span class="s1">readPreference</span><span class="s2">: </span><span class="s1">ReadPreference</span><span class="s2">.</span><span class="s1">primaryPreferred</span><span class="s2">, </span><span class="s1">noResponse</span><span class="s2">: </span><span class="s0">true </span><span class="s2">}</span>
<a name="l595"><span class="ln">595  </span></a>          <span class="s2">)</span>
<a name="l596"><span class="ln">596  </span></a>        <span class="s2">).</span><span class="s1">catch</span><span class="s2">(() =&gt; </span><span class="s0">null</span><span class="s2">); </span><span class="s6">// outcome does not matter;</span>
<a name="l597"><span class="ln">597  </span></a>      <span class="s2">}</span>
<a name="l598"><span class="ln">598  </span></a>    <span class="s2">}</span>
<a name="l599"><span class="ln">599  </span></a>
<a name="l600"><span class="ln">600  </span></a>    <span class="s6">// clear out references to old topology</span>
<a name="l601"><span class="ln">601  </span></a>    <span class="s0">const </span><span class="s1">topology </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">topology</span><span class="s2">;</span>
<a name="l602"><span class="ln">602  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">topology </span><span class="s2">= </span><span class="s1">undefined</span><span class="s2">;</span>
<a name="l603"><span class="ln">603  </span></a>
<a name="l604"><span class="ln">604  </span></a>    <span class="s0">await new </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s0">void</span><span class="s2">&gt;((</span><span class="s1">resolve</span><span class="s2">, </span><span class="s1">reject</span><span class="s2">) =&gt; {</span>
<a name="l605"><span class="ln">605  </span></a>      <span class="s1">topology</span><span class="s2">.</span><span class="s1">close</span><span class="s2">({ </span><span class="s1">force </span><span class="s2">}, </span><span class="s1">error </span><span class="s2">=&gt; {</span>
<a name="l606"><span class="ln">606  </span></a>        <span class="s0">if </span><span class="s2">(</span><span class="s1">error</span><span class="s2">) </span><span class="s0">return </span><span class="s1">reject</span><span class="s2">(</span><span class="s1">error</span><span class="s2">);</span>
<a name="l607"><span class="ln">607  </span></a>        <span class="s0">const </span><span class="s2">{ </span><span class="s1">encrypter </span><span class="s2">} = </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">];</span>
<a name="l608"><span class="ln">608  </span></a>        <span class="s0">if </span><span class="s2">(</span><span class="s1">encrypter</span><span class="s2">) {</span>
<a name="l609"><span class="ln">609  </span></a>          <span class="s0">return </span><span class="s1">encrypter</span><span class="s2">.</span><span class="s1">closeCallback</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">force</span><span class="s2">, </span><span class="s1">error </span><span class="s2">=&gt; {</span>
<a name="l610"><span class="ln">610  </span></a>            <span class="s0">if </span><span class="s2">(</span><span class="s1">error</span><span class="s2">) </span><span class="s0">return </span><span class="s1">reject</span><span class="s2">(</span><span class="s1">error</span><span class="s2">);</span>
<a name="l611"><span class="ln">611  </span></a>            <span class="s1">resolve</span><span class="s2">();</span>
<a name="l612"><span class="ln">612  </span></a>          <span class="s2">});</span>
<a name="l613"><span class="ln">613  </span></a>        <span class="s2">}</span>
<a name="l614"><span class="ln">614  </span></a>        <span class="s1">resolve</span><span class="s2">();</span>
<a name="l615"><span class="ln">615  </span></a>      <span class="s2">});</span>
<a name="l616"><span class="ln">616  </span></a>    <span class="s2">});</span>
<a name="l617"><span class="ln">617  </span></a>  <span class="s2">}</span>
<a name="l618"><span class="ln">618  </span></a>
<a name="l619"><span class="ln">619  </span></a>  <span class="s4">/**</span>
<a name="l620"><span class="ln">620  </span></a>   <span class="s4">* Create a new Db instance sharing the current socket connections.</span>
<a name="l621"><span class="ln">621  </span></a>   <span class="s4">*</span>
<a name="l622"><span class="ln">622  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">dbName - The name of the database we want to use. If not provided, use database name from connection string.</span>
<a name="l623"><span class="ln">623  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">options - Optional settings for Db construction</span>
<a name="l624"><span class="ln">624  </span></a>   <span class="s4">*/</span>
<a name="l625"><span class="ln">625  </span></a>  <span class="s1">db</span><span class="s2">(</span><span class="s1">dbName</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">, </span><span class="s1">options</span><span class="s2">?: </span><span class="s1">DbOptions</span><span class="s2">): </span><span class="s1">Db </span><span class="s2">{</span>
<a name="l626"><span class="ln">626  </span></a>    <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">?? {};</span>
<a name="l627"><span class="ln">627  </span></a>
<a name="l628"><span class="ln">628  </span></a>    <span class="s6">// Default to db from connection string if not provided</span>
<a name="l629"><span class="ln">629  </span></a>    <span class="s0">if </span><span class="s2">(!</span><span class="s1">dbName</span><span class="s2">) {</span>
<a name="l630"><span class="ln">630  </span></a>      <span class="s1">dbName </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">dbName</span><span class="s2">;</span>
<a name="l631"><span class="ln">631  </span></a>    <span class="s2">}</span>
<a name="l632"><span class="ln">632  </span></a>
<a name="l633"><span class="ln">633  </span></a>    <span class="s6">// Copy the options and add out internal override of the not shared flag</span>
<a name="l634"><span class="ln">634  </span></a>    <span class="s0">const </span><span class="s1">finalOptions </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">assign</span><span class="s2">({}, </span><span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">], </span><span class="s1">options</span><span class="s2">);</span>
<a name="l635"><span class="ln">635  </span></a>
<a name="l636"><span class="ln">636  </span></a>    <span class="s6">// Return the db object</span>
<a name="l637"><span class="ln">637  </span></a>    <span class="s0">const </span><span class="s1">db </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Db</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">dbName</span><span class="s2">, </span><span class="s1">finalOptions</span><span class="s2">);</span>
<a name="l638"><span class="ln">638  </span></a>
<a name="l639"><span class="ln">639  </span></a>    <span class="s6">// Return the database</span>
<a name="l640"><span class="ln">640  </span></a>    <span class="s0">return </span><span class="s1">db</span><span class="s2">;</span>
<a name="l641"><span class="ln">641  </span></a>  <span class="s2">}</span>
<a name="l642"><span class="ln">642  </span></a>
<a name="l643"><span class="ln">643  </span></a>  <span class="s4">/**</span>
<a name="l644"><span class="ln">644  </span></a>   <span class="s4">* Connect to MongoDB using a url</span>
<a name="l645"><span class="ln">645  </span></a>   <span class="s4">*</span>
<a name="l646"><span class="ln">646  </span></a>   <span class="s4">* </span><span class="s5">@remarks</span>
<a name="l647"><span class="ln">647  </span></a>   <span class="s4">* The programmatically provided options take precedence over the URI options.</span>
<a name="l648"><span class="ln">648  </span></a>   <span class="s4">*</span>
<a name="l649"><span class="ln">649  </span></a>   <span class="s4">* </span><span class="s5">@see </span><span class="s4">https://www.mongodb.com/docs/manual/reference/connection-string/</span>
<a name="l650"><span class="ln">650  </span></a>   <span class="s4">*/</span>
<a name="l651"><span class="ln">651  </span></a>  <span class="s0">static </span><span class="s1">async connect</span><span class="s2">(</span><span class="s1">url</span><span class="s2">: </span><span class="s1">string</span><span class="s2">, </span><span class="s1">options</span><span class="s2">?: </span><span class="s1">MongoClientOptions</span><span class="s2">): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s1">MongoClient</span><span class="s2">&gt; {</span>
<a name="l652"><span class="ln">652  </span></a>    <span class="s0">const </span><span class="s1">client </span><span class="s2">= </span><span class="s0">new this</span><span class="s2">(</span><span class="s1">url</span><span class="s2">, </span><span class="s1">options</span><span class="s2">);</span>
<a name="l653"><span class="ln">653  </span></a>    <span class="s0">return </span><span class="s1">client</span><span class="s2">.</span><span class="s1">connect</span><span class="s2">();</span>
<a name="l654"><span class="ln">654  </span></a>  <span class="s2">}</span>
<a name="l655"><span class="ln">655  </span></a>
<a name="l656"><span class="ln">656  </span></a>  <span class="s4">/**</span>
<a name="l657"><span class="ln">657  </span></a>   <span class="s4">* Creates a new ClientSession. When using the returned session in an operation</span>
<a name="l658"><span class="ln">658  </span></a>   <span class="s4">* a corresponding ServerSession will be created.</span>
<a name="l659"><span class="ln">659  </span></a>   <span class="s4">*</span>
<a name="l660"><span class="ln">660  </span></a>   <span class="s4">* </span><span class="s5">@remarks</span>
<a name="l661"><span class="ln">661  </span></a>   <span class="s4">* A ClientSession instance may only be passed to operations being performed on the same</span>
<a name="l662"><span class="ln">662  </span></a>   <span class="s4">* MongoClient it was started from.</span>
<a name="l663"><span class="ln">663  </span></a>   <span class="s4">*/</span>
<a name="l664"><span class="ln">664  </span></a>  <span class="s1">startSession</span><span class="s2">(</span><span class="s1">options</span><span class="s2">?: </span><span class="s1">ClientSessionOptions</span><span class="s2">): </span><span class="s1">ClientSession </span><span class="s2">{</span>
<a name="l665"><span class="ln">665  </span></a>    <span class="s0">const </span><span class="s1">session </span><span class="s2">= </span><span class="s0">new </span><span class="s1">ClientSession</span><span class="s2">(</span>
<a name="l666"><span class="ln">666  </span></a>      <span class="s0">this</span><span class="s2">,</span>
<a name="l667"><span class="ln">667  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">sessionPool</span><span class="s2">,</span>
<a name="l668"><span class="ln">668  </span></a>      <span class="s2">{ </span><span class="s1">explicit</span><span class="s2">: </span><span class="s0">true</span><span class="s2">, </span><span class="s1">...options </span><span class="s2">},</span>
<a name="l669"><span class="ln">669  </span></a>      <span class="s0">this</span><span class="s2">[</span><span class="s1">kOptions</span><span class="s2">]</span>
<a name="l670"><span class="ln">670  </span></a>    <span class="s2">);</span>
<a name="l671"><span class="ln">671  </span></a>    <span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">activeSessions</span><span class="s2">.</span><span class="s1">add</span><span class="s2">(</span><span class="s1">session</span><span class="s2">);</span>
<a name="l672"><span class="ln">672  </span></a>    <span class="s1">session</span><span class="s2">.</span><span class="s1">once</span><span class="s2">(</span><span class="s3">'ended'</span><span class="s2">, () =&gt; {</span>
<a name="l673"><span class="ln">673  </span></a>      <span class="s0">this</span><span class="s2">.</span><span class="s1">s</span><span class="s2">.</span><span class="s1">activeSessions</span><span class="s2">.</span><span class="s1">delete</span><span class="s2">(</span><span class="s1">session</span><span class="s2">);</span>
<a name="l674"><span class="ln">674  </span></a>    <span class="s2">});</span>
<a name="l675"><span class="ln">675  </span></a>    <span class="s0">return </span><span class="s1">session</span><span class="s2">;</span>
<a name="l676"><span class="ln">676  </span></a>  <span class="s2">}</span>
<a name="l677"><span class="ln">677  </span></a>
<a name="l678"><span class="ln">678  </span></a>  <span class="s4">/**</span>
<a name="l679"><span class="ln">679  </span></a>   <span class="s4">* A convenience method for creating and handling the clean up of a ClientSession.</span>
<a name="l680"><span class="ln">680  </span></a>   <span class="s4">* The session will always be ended when the executor finishes.</span>
<a name="l681"><span class="ln">681  </span></a>   <span class="s4">*</span>
<a name="l682"><span class="ln">682  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">executor - An executor function that all operations using the provided session must be invoked in</span>
<a name="l683"><span class="ln">683  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">options - optional settings for the session</span>
<a name="l684"><span class="ln">684  </span></a>   <span class="s4">*/</span>
<a name="l685"><span class="ln">685  </span></a>  <span class="s1">async withSession</span><span class="s2">&lt;</span><span class="s1">T </span><span class="s2">= </span><span class="s1">any</span><span class="s2">&gt;(</span><span class="s1">executor</span><span class="s2">: </span><span class="s1">WithSessionCallback</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;;</span>
<a name="l686"><span class="ln">686  </span></a>  <span class="s1">async withSession</span><span class="s2">&lt;</span><span class="s1">T </span><span class="s2">= </span><span class="s1">any</span><span class="s2">&gt;(</span>
<a name="l687"><span class="ln">687  </span></a>    <span class="s1">options</span><span class="s2">: </span><span class="s1">ClientSessionOptions</span><span class="s2">,</span>
<a name="l688"><span class="ln">688  </span></a>    <span class="s1">executor</span><span class="s2">: </span><span class="s1">WithSessionCallback</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;</span>
<a name="l689"><span class="ln">689  </span></a>  <span class="s2">): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;;</span>
<a name="l690"><span class="ln">690  </span></a>  <span class="s1">async withSession</span><span class="s2">&lt;</span><span class="s1">T </span><span class="s2">= </span><span class="s1">any</span><span class="s2">&gt;(</span>
<a name="l691"><span class="ln">691  </span></a>    <span class="s1">optionsOrExecutor</span><span class="s2">: </span><span class="s1">ClientSessionOptions </span><span class="s2">| </span><span class="s1">WithSessionCallback</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;,</span>
<a name="l692"><span class="ln">692  </span></a>    <span class="s1">executor</span><span class="s2">?: </span><span class="s1">WithSessionCallback</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt;</span>
<a name="l693"><span class="ln">693  </span></a>  <span class="s2">): </span><span class="s1">Promise</span><span class="s2">&lt;</span><span class="s1">T</span><span class="s2">&gt; {</span>
<a name="l694"><span class="ln">694  </span></a>    <span class="s0">const </span><span class="s1">options </span><span class="s2">= {</span>
<a name="l695"><span class="ln">695  </span></a>      <span class="s6">// Always define an owner</span>
<a name="l696"><span class="ln">696  </span></a>      <span class="s1">owner</span><span class="s2">: </span><span class="s1">Symbol</span><span class="s2">(),</span>
<a name="l697"><span class="ln">697  </span></a>      <span class="s6">// If it's an object inherit the options</span>
<a name="l698"><span class="ln">698  </span></a>      <span class="s1">...</span><span class="s2">(</span><span class="s0">typeof </span><span class="s1">optionsOrExecutor </span><span class="s2">=== </span><span class="s3">'object' </span><span class="s2">? </span><span class="s1">optionsOrExecutor </span><span class="s2">: {})</span>
<a name="l699"><span class="ln">699  </span></a>    <span class="s2">};</span>
<a name="l700"><span class="ln">700  </span></a>
<a name="l701"><span class="ln">701  </span></a>    <span class="s0">const </span><span class="s1">withSessionCallback </span><span class="s2">=</span>
<a name="l702"><span class="ln">702  </span></a>      <span class="s0">typeof </span><span class="s1">optionsOrExecutor </span><span class="s2">=== </span><span class="s3">'function' </span><span class="s2">? </span><span class="s1">optionsOrExecutor </span><span class="s2">: </span><span class="s1">executor</span><span class="s2">;</span>
<a name="l703"><span class="ln">703  </span></a>
<a name="l704"><span class="ln">704  </span></a>    <span class="s0">if </span><span class="s2">(</span><span class="s1">withSessionCallback </span><span class="s2">== </span><span class="s0">null</span><span class="s2">) {</span>
<a name="l705"><span class="ln">705  </span></a>      <span class="s0">throw new </span><span class="s1">MongoInvalidArgumentError</span><span class="s2">(</span><span class="s3">'Missing required callback parameter'</span><span class="s2">);</span>
<a name="l706"><span class="ln">706  </span></a>    <span class="s2">}</span>
<a name="l707"><span class="ln">707  </span></a>
<a name="l708"><span class="ln">708  </span></a>    <span class="s0">const </span><span class="s1">session </span><span class="s2">= </span><span class="s0">this</span><span class="s2">.</span><span class="s1">startSession</span><span class="s2">(</span><span class="s1">options</span><span class="s2">);</span>
<a name="l709"><span class="ln">709  </span></a>
<a name="l710"><span class="ln">710  </span></a>    <span class="s0">try </span><span class="s2">{</span>
<a name="l711"><span class="ln">711  </span></a>      <span class="s0">return await </span><span class="s1">withSessionCallback</span><span class="s2">(</span><span class="s1">session</span><span class="s2">);</span>
<a name="l712"><span class="ln">712  </span></a>    <span class="s2">} </span><span class="s0">finally </span><span class="s2">{</span>
<a name="l713"><span class="ln">713  </span></a>      <span class="s0">try </span><span class="s2">{</span>
<a name="l714"><span class="ln">714  </span></a>        <span class="s0">await </span><span class="s1">session</span><span class="s2">.</span><span class="s1">endSession</span><span class="s2">();</span>
<a name="l715"><span class="ln">715  </span></a>      <span class="s2">} </span><span class="s0">catch </span><span class="s2">{</span>
<a name="l716"><span class="ln">716  </span></a>        <span class="s6">// We are not concerned with errors from endSession()</span>
<a name="l717"><span class="ln">717  </span></a>      <span class="s2">}</span>
<a name="l718"><span class="ln">718  </span></a>    <span class="s2">}</span>
<a name="l719"><span class="ln">719  </span></a>  <span class="s2">}</span>
<a name="l720"><span class="ln">720  </span></a>
<a name="l721"><span class="ln">721  </span></a>  <span class="s4">/**</span>
<a name="l722"><span class="ln">722  </span></a>   <span class="s4">* Create a new Change Stream, watching for new changes (insertions, updates,</span>
<a name="l723"><span class="ln">723  </span></a>   <span class="s4">* replacements, deletions, and invalidations) in this cluster. Will ignore all</span>
<a name="l724"><span class="ln">724  </span></a>   <span class="s4">* changes to system collections, as well as the local, admin, and config databases.</span>
<a name="l725"><span class="ln">725  </span></a>   <span class="s4">*</span>
<a name="l726"><span class="ln">726  </span></a>   <span class="s4">* </span><span class="s5">@remarks</span>
<a name="l727"><span class="ln">727  </span></a>   <span class="s4">* watch() accepts two generic arguments for distinct use cases:</span>
<a name="l728"><span class="ln">728  </span></a>   <span class="s4">* - The first is to provide the schema that may be defined for all the data within the current cluster</span>
<a name="l729"><span class="ln">729  </span></a>   <span class="s4">* - The second is to override the shape of the change stream document entirely, if it is not provided the type will default to ChangeStreamDocument of the first argument</span>
<a name="l730"><span class="ln">730  </span></a>   <span class="s4">*</span>
<a name="l731"><span class="ln">731  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">pipeline - An array of {</span><span class="s5">@link </span><span class="s4">https://www.mongodb.com/docs/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.</span>
<a name="l732"><span class="ln">732  </span></a>   <span class="s4">* </span><span class="s5">@param </span><span class="s4">options - Optional settings for the command</span>
<a name="l733"><span class="ln">733  </span></a>   <span class="s4">* </span><span class="s5">@typeParam </span><span class="s4">TSchema - Type of the data being detected by the change stream</span>
<a name="l734"><span class="ln">734  </span></a>   <span class="s4">* </span><span class="s5">@typeParam </span><span class="s4">TChange - Type of the whole change stream document emitted</span>
<a name="l735"><span class="ln">735  </span></a>   <span class="s4">*/</span>
<a name="l736"><span class="ln">736  </span></a>  <span class="s1">watch</span><span class="s2">&lt;</span>
<a name="l737"><span class="ln">737  </span></a>    <span class="s1">TSchema </span><span class="s0">extends </span><span class="s1">Document </span><span class="s2">= </span><span class="s1">Document</span><span class="s2">,</span>
<a name="l738"><span class="ln">738  </span></a>    <span class="s1">TChange </span><span class="s0">extends </span><span class="s1">Document </span><span class="s2">= </span><span class="s1">ChangeStreamDocument</span><span class="s2">&lt;</span><span class="s1">TSchema</span><span class="s2">&gt;</span>
<a name="l739"><span class="ln">739  </span></a>  <span class="s2">&gt;(</span><span class="s1">pipeline</span><span class="s2">: </span><span class="s1">Document</span><span class="s2">[] = [], </span><span class="s1">options</span><span class="s2">: </span><span class="s1">ChangeStreamOptions </span><span class="s2">= {}): </span><span class="s1">ChangeStream</span><span class="s2">&lt;</span><span class="s1">TSchema</span><span class="s2">, </span><span class="s1">TChange</span><span class="s2">&gt; {</span>
<a name="l740"><span class="ln">740  </span></a>    <span class="s6">// Allow optionally not specifying a pipeline</span>
<a name="l741"><span class="ln">741  </span></a>    <span class="s0">if </span><span class="s2">(!</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">pipeline</span><span class="s2">)) {</span>
<a name="l742"><span class="ln">742  </span></a>      <span class="s1">options </span><span class="s2">= </span><span class="s1">pipeline</span><span class="s2">;</span>
<a name="l743"><span class="ln">743  </span></a>      <span class="s1">pipeline </span><span class="s2">= [];</span>
<a name="l744"><span class="ln">744  </span></a>    <span class="s2">}</span>
<a name="l745"><span class="ln">745  </span></a>
<a name="l746"><span class="ln">746  </span></a>    <span class="s0">return new </span><span class="s1">ChangeStream</span><span class="s2">&lt;</span><span class="s1">TSchema</span><span class="s2">, </span><span class="s1">TChange</span><span class="s2">&gt;(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">pipeline</span><span class="s2">, </span><span class="s1">resolveOptions</span><span class="s2">(</span><span class="s0">this</span><span class="s2">, </span><span class="s1">options</span><span class="s2">));</span>
<a name="l747"><span class="ln">747  </span></a>  <span class="s2">}</span>
<a name="l748"><span class="ln">748  </span></a><span class="s2">}</span>
<a name="l749"><span class="ln">749  </span></a>
<a name="l750"><span class="ln">750  </span></a><span class="s4">/**</span>
<a name="l751"><span class="ln">751  </span></a> <span class="s4">* Parsed Mongo Client Options.</span>
<a name="l752"><span class="ln">752  </span></a> <span class="s4">*</span>
<a name="l753"><span class="ln">753  </span></a> <span class="s4">* User supplied options are documented by `MongoClientOptions`.</span>
<a name="l754"><span class="ln">754  </span></a> <span class="s4">*</span>
<a name="l755"><span class="ln">755  </span></a> <span class="s4">* **NOTE:** The client's options parsing is subject to change to support new features.</span>
<a name="l756"><span class="ln">756  </span></a> <span class="s4">* This type is provided to aid with inspection of options after parsing, it should not be relied upon programmatically.</span>
<a name="l757"><span class="ln">757  </span></a> <span class="s4">*</span>
<a name="l758"><span class="ln">758  </span></a> <span class="s4">* Options are sourced from:</span>
<a name="l759"><span class="ln">759  </span></a> <span class="s4">* - connection string</span>
<a name="l760"><span class="ln">760  </span></a> <span class="s4">* - options object passed to the MongoClient constructor</span>
<a name="l761"><span class="ln">761  </span></a> <span class="s4">* - file system (ex. tls settings)</span>
<a name="l762"><span class="ln">762  </span></a> <span class="s4">* - environment variables</span>
<a name="l763"><span class="ln">763  </span></a> <span class="s4">* - DNS SRV records and TXT records</span>
<a name="l764"><span class="ln">764  </span></a> <span class="s4">*</span>
<a name="l765"><span class="ln">765  </span></a> <span class="s4">* Not all options may be present after client construction as some are obtained from asynchronous operations.</span>
<a name="l766"><span class="ln">766  </span></a> <span class="s4">*</span>
<a name="l767"><span class="ln">767  </span></a> <span class="s4">* </span><span class="s5">@public</span>
<a name="l768"><span class="ln">768  </span></a> <span class="s4">*/</span>
<a name="l769"><span class="ln">769  </span></a><span class="s0">export interface </span><span class="s1">MongoOptions</span>
<a name="l770"><span class="ln">770  </span></a>  <span class="s0">extends </span><span class="s1">Required</span><span class="s2">&lt;</span>
<a name="l771"><span class="ln">771  </span></a>      <span class="s1">Pick</span><span class="s2">&lt;</span>
<a name="l772"><span class="ln">772  </span></a>        <span class="s1">MongoClientOptions</span><span class="s2">,</span>
<a name="l773"><span class="ln">773  </span></a>        <span class="s2">| </span><span class="s3">'autoEncryption'</span>
<a name="l774"><span class="ln">774  </span></a>        <span class="s2">| </span><span class="s3">'connectTimeoutMS'</span>
<a name="l775"><span class="ln">775  </span></a>        <span class="s2">| </span><span class="s3">'directConnection'</span>
<a name="l776"><span class="ln">776  </span></a>        <span class="s2">| </span><span class="s3">'driverInfo'</span>
<a name="l777"><span class="ln">777  </span></a>        <span class="s2">| </span><span class="s3">'forceServerObjectId'</span>
<a name="l778"><span class="ln">778  </span></a>        <span class="s2">| </span><span class="s3">'minHeartbeatFrequencyMS'</span>
<a name="l779"><span class="ln">779  </span></a>        <span class="s2">| </span><span class="s3">'heartbeatFrequencyMS'</span>
<a name="l780"><span class="ln">780  </span></a>        <span class="s2">| </span><span class="s3">'localThresholdMS'</span>
<a name="l781"><span class="ln">781  </span></a>        <span class="s2">| </span><span class="s3">'maxConnecting'</span>
<a name="l782"><span class="ln">782  </span></a>        <span class="s2">| </span><span class="s3">'maxIdleTimeMS'</span>
<a name="l783"><span class="ln">783  </span></a>        <span class="s2">| </span><span class="s3">'maxPoolSize'</span>
<a name="l784"><span class="ln">784  </span></a>        <span class="s2">| </span><span class="s3">'minPoolSize'</span>
<a name="l785"><span class="ln">785  </span></a>        <span class="s2">| </span><span class="s3">'monitorCommands'</span>
<a name="l786"><span class="ln">786  </span></a>        <span class="s2">| </span><span class="s3">'noDelay'</span>
<a name="l787"><span class="ln">787  </span></a>        <span class="s2">| </span><span class="s3">'pkFactory'</span>
<a name="l788"><span class="ln">788  </span></a>        <span class="s2">| </span><span class="s3">'raw'</span>
<a name="l789"><span class="ln">789  </span></a>        <span class="s2">| </span><span class="s3">'replicaSet'</span>
<a name="l790"><span class="ln">790  </span></a>        <span class="s2">| </span><span class="s3">'retryReads'</span>
<a name="l791"><span class="ln">791  </span></a>        <span class="s2">| </span><span class="s3">'retryWrites'</span>
<a name="l792"><span class="ln">792  </span></a>        <span class="s2">| </span><span class="s3">'serverSelectionTimeoutMS'</span>
<a name="l793"><span class="ln">793  </span></a>        <span class="s2">| </span><span class="s3">'socketTimeoutMS'</span>
<a name="l794"><span class="ln">794  </span></a>        <span class="s2">| </span><span class="s3">'srvMaxHosts'</span>
<a name="l795"><span class="ln">795  </span></a>        <span class="s2">| </span><span class="s3">'srvServiceName'</span>
<a name="l796"><span class="ln">796  </span></a>        <span class="s2">| </span><span class="s3">'tlsAllowInvalidCertificates'</span>
<a name="l797"><span class="ln">797  </span></a>        <span class="s2">| </span><span class="s3">'tlsAllowInvalidHostnames'</span>
<a name="l798"><span class="ln">798  </span></a>        <span class="s2">| </span><span class="s3">'tlsInsecure'</span>
<a name="l799"><span class="ln">799  </span></a>        <span class="s2">| </span><span class="s3">'waitQueueTimeoutMS'</span>
<a name="l800"><span class="ln">800  </span></a>        <span class="s2">| </span><span class="s3">'zlibCompressionLevel'</span>
<a name="l801"><span class="ln">801  </span></a>      <span class="s2">&gt;</span>
<a name="l802"><span class="ln">802  </span></a>    <span class="s2">&gt;,</span>
<a name="l803"><span class="ln">803  </span></a>    <span class="s1">SupportedNodeConnectionOptions </span><span class="s2">{</span>
<a name="l804"><span class="ln">804  </span></a>  <span class="s1">appName</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l805"><span class="ln">805  </span></a>  <span class="s1">hosts</span><span class="s2">: </span><span class="s1">HostAddress</span><span class="s2">[];</span>
<a name="l806"><span class="ln">806  </span></a>  <span class="s1">srvHost</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l807"><span class="ln">807  </span></a>  <span class="s1">credentials</span><span class="s2">?: </span><span class="s1">MongoCredentials</span><span class="s2">;</span>
<a name="l808"><span class="ln">808  </span></a>  <span class="s1">readPreference</span><span class="s2">: </span><span class="s1">ReadPreference</span><span class="s2">;</span>
<a name="l809"><span class="ln">809  </span></a>  <span class="s1">readConcern</span><span class="s2">: </span><span class="s1">ReadConcern</span><span class="s2">;</span>
<a name="l810"><span class="ln">810  </span></a>  <span class="s1">loadBalanced</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l811"><span class="ln">811  </span></a>  <span class="s1">serverApi</span><span class="s2">: </span><span class="s1">ServerApi</span><span class="s2">;</span>
<a name="l812"><span class="ln">812  </span></a>  <span class="s1">compressors</span><span class="s2">: </span><span class="s1">CompressorName</span><span class="s2">[];</span>
<a name="l813"><span class="ln">813  </span></a>  <span class="s1">writeConcern</span><span class="s2">: </span><span class="s1">WriteConcern</span><span class="s2">;</span>
<a name="l814"><span class="ln">814  </span></a>  <span class="s1">dbName</span><span class="s2">: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l815"><span class="ln">815  </span></a>  <span class="s1">metadata</span><span class="s2">: </span><span class="s1">ClientMetadata</span><span class="s2">;</span>
<a name="l816"><span class="ln">816  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l817"><span class="ln">817  </span></a>  <span class="s1">autoEncrypter</span><span class="s2">?: </span><span class="s1">AutoEncrypter</span><span class="s2">;</span>
<a name="l818"><span class="ln">818  </span></a>  <span class="s1">proxyHost</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l819"><span class="ln">819  </span></a>  <span class="s1">proxyPort</span><span class="s2">?: </span><span class="s1">number</span><span class="s2">;</span>
<a name="l820"><span class="ln">820  </span></a>  <span class="s1">proxyUsername</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l821"><span class="ln">821  </span></a>  <span class="s1">proxyPassword</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l822"><span class="ln">822  </span></a>  <span class="s1">serverMonitoringMode</span><span class="s2">: </span><span class="s1">ServerMonitoringMode</span><span class="s2">;</span>
<a name="l823"><span class="ln">823  </span></a>
<a name="l824"><span class="ln">824  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l825"><span class="ln">825  </span></a>  <span class="s1">connectionType</span><span class="s2">?: </span><span class="s0">typeof </span><span class="s1">Connection</span><span class="s2">;</span>
<a name="l826"><span class="ln">826  </span></a>
<a name="l827"><span class="ln">827  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l828"><span class="ln">828  </span></a>  <span class="s1">encrypter</span><span class="s2">: </span><span class="s1">Encrypter</span><span class="s2">;</span>
<a name="l829"><span class="ln">829  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l830"><span class="ln">830  </span></a>  <span class="s1">userSpecifiedAuthSource</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l831"><span class="ln">831  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l832"><span class="ln">832  </span></a>  <span class="s1">userSpecifiedReplicaSet</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l833"><span class="ln">833  </span></a>
<a name="l834"><span class="ln">834  </span></a>  <span class="s4">/**</span>
<a name="l835"><span class="ln">835  </span></a>   <span class="s4">* # NOTE ABOUT TLS Options</span>
<a name="l836"><span class="ln">836  </span></a>   <span class="s4">*</span>
<a name="l837"><span class="ln">837  </span></a>   <span class="s4">* If `tls` is provided as an option, it is equivalent to setting the `ssl` option.</span>
<a name="l838"><span class="ln">838  </span></a>   <span class="s4">*</span>
<a name="l839"><span class="ln">839  </span></a>   <span class="s4">* NodeJS native TLS options are passed through to the socket and retain their original types.</span>
<a name="l840"><span class="ln">840  </span></a>   <span class="s4">*</span>
<a name="l841"><span class="ln">841  </span></a>   <span class="s4">* ### Additional options:</span>
<a name="l842"><span class="ln">842  </span></a>   <span class="s4">*</span>
<a name="l843"><span class="ln">843  </span></a>   <span class="s4">* | nodejs native option  | driver spec equivalent option name            | driver option type |</span>
<a name="l844"><span class="ln">844  </span></a>   <span class="s4">* |:----------------------|:----------------------------------------------|:-------------------|</span>
<a name="l845"><span class="ln">845  </span></a>   <span class="s4">* | `ca`                  | `tlsCAFile`                                   | `string`           |</span>
<a name="l846"><span class="ln">846  </span></a>   <span class="s4">* | `crl`                 | `tlsCRLFile`                                  | `string`           |</span>
<a name="l847"><span class="ln">847  </span></a>   <span class="s4">* | `cert`                | `tlsCertificateKeyFile`                       | `string`           |</span>
<a name="l848"><span class="ln">848  </span></a>   <span class="s4">* | `key`                 | `tlsCertificateKeyFile`                       | `string`           |</span>
<a name="l849"><span class="ln">849  </span></a>   <span class="s4">* | `passphrase`          | `tlsCertificateKeyFilePassword`               | `string`           |</span>
<a name="l850"><span class="ln">850  </span></a>   <span class="s4">* | `rejectUnauthorized`  | `tlsAllowInvalidCertificates`                 | `boolean`          |</span>
<a name="l851"><span class="ln">851  </span></a>   <span class="s4">* | `checkServerIdentity` | `tlsAllowInvalidHostnames`                    | `boolean`          |</span>
<a name="l852"><span class="ln">852  </span></a>   <span class="s4">* | see note below        | `tlsInsecure`                                 | `boolean`          |</span>
<a name="l853"><span class="ln">853  </span></a>   <span class="s4">*</span>
<a name="l854"><span class="ln">854  </span></a>   <span class="s4">* If `tlsInsecure` is set to `true`, then it will set the node native options `checkServerIdentity`</span>
<a name="l855"><span class="ln">855  </span></a>   <span class="s4">* to a no-op and `rejectUnauthorized` to `false`.</span>
<a name="l856"><span class="ln">856  </span></a>   <span class="s4">*</span>
<a name="l857"><span class="ln">857  </span></a>   <span class="s4">* If `tlsInsecure` is set to `false`, then it will set the node native options `checkServerIdentity`</span>
<a name="l858"><span class="ln">858  </span></a>   <span class="s4">* to a no-op and `rejectUnauthorized` to the inverse value of `tlsAllowInvalidCertificates`. If</span>
<a name="l859"><span class="ln">859  </span></a>   <span class="s4">* `tlsAllowInvalidCertificates` is not set, then `rejectUnauthorized` will be set to `true`.</span>
<a name="l860"><span class="ln">860  </span></a>   <span class="s4">*</span>
<a name="l861"><span class="ln">861  </span></a>   <span class="s4">* ### Note on `tlsCAFile`, `tlsCertificateKeyFile` and `tlsCRLFile`</span>
<a name="l862"><span class="ln">862  </span></a>   <span class="s4">*</span>
<a name="l863"><span class="ln">863  </span></a>   <span class="s4">* The files specified by the paths passed in to the `tlsCAFile`, `tlsCertificateKeyFile` and `tlsCRLFile`</span>
<a name="l864"><span class="ln">864  </span></a>   <span class="s4">* fields are read lazily on the first call to `MongoClient.connect`. Once these files have been read and</span>
<a name="l865"><span class="ln">865  </span></a>   <span class="s4">* the `ca`, `cert`, `crl` and `key` fields are populated, they will not be read again on subsequent calls to</span>
<a name="l866"><span class="ln">866  </span></a>   <span class="s4">* `MongoClient.connect`. As a result, until the first call to `MongoClient.connect`, the `ca`,</span>
<a name="l867"><span class="ln">867  </span></a>   <span class="s4">* `cert`, `crl` and `key` fields will be undefined.</span>
<a name="l868"><span class="ln">868  </span></a>   <span class="s4">*/</span>
<a name="l869"><span class="ln">869  </span></a>  <span class="s1">tls</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">;</span>
<a name="l870"><span class="ln">870  </span></a>  <span class="s1">tlsCAFile</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l871"><span class="ln">871  </span></a>  <span class="s1">tlsCRLFile</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l872"><span class="ln">872  </span></a>  <span class="s1">tlsCertificateKeyFile</span><span class="s2">?: </span><span class="s1">string</span><span class="s2">;</span>
<a name="l873"><span class="ln">873  </span></a>
<a name="l874"><span class="ln">874  </span></a>  <span class="s4">/** </span><span class="s5">@internal </span><span class="s4">*/</span>
<a name="l875"><span class="ln">875  </span></a>  <span class="s2">[</span><span class="s1">featureFlag</span><span class="s2">: </span><span class="s1">symbol</span><span class="s2">]: </span><span class="s1">any</span><span class="s2">;</span>
<a name="l876"><span class="ln">876  </span></a>
<a name="l877"><span class="ln">877  </span></a>  <span class="s4">/**</span>
<a name="l878"><span class="ln">878  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l879"><span class="ln">879  </span></a>   <span class="s4">* TODO: NODE-5671 - remove internal flag</span>
<a name="l880"><span class="ln">880  </span></a>   <span class="s4">*/</span>
<a name="l881"><span class="ln">881  </span></a>  <span class="s1">mongoLoggerOptions</span><span class="s2">: </span><span class="s1">MongoLoggerOptions</span><span class="s2">;</span>
<a name="l882"><span class="ln">882  </span></a>  <span class="s4">/**</span>
<a name="l883"><span class="ln">883  </span></a>   <span class="s4">* </span><span class="s5">@internal</span>
<a name="l884"><span class="ln">884  </span></a>   <span class="s4">* TODO: NODE-5671 - remove internal flag</span>
<a name="l885"><span class="ln">885  </span></a>   <span class="s4">*/</span>
<a name="l886"><span class="ln">886  </span></a>  <span class="s1">mongodbLogPath</span><span class="s2">?: </span><span class="s3">'stderr' </span><span class="s2">| </span><span class="s3">'stdout' </span><span class="s2">| </span><span class="s1">MongoDBLogWritable</span><span class="s2">;</span>
<a name="l887"><span class="ln">887  </span></a><span class="s2">}</span>
<a name="l888"><span class="ln">888  </span></a></pre>
</body>
</html>